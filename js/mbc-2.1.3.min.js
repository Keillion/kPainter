/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Mobile Browser Capture
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2018, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 2.1.3
 * @fileoverview Dynamsoft JavaScript Library for Basic Image Edit
 * More info on MBC: http://www.dynamsoft.com/
 */
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var a=0;return $jscomp.iteratorPrototype(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var a=c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};
$jscomp.polyfill=function(c,a,b,h){if(a){b=$jscomp.global;c=c.split(".");for(h=0;h<c.length-1;h++){var x=c[h];x in b||(b[x]={});b=b[x]}c=c[c.length-1];h=b[c];a=a(h);a!=h&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function a(){this.batch_=null}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var b=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){b(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(q){this.asyncThrow_(q)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var h=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(W){b.reject(W)}};h.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};h.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof h)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};h.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(W){this.reject_(W);return}"function"==
typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};h.prototype.reject_=function(a){this.settle_(2,a)};h.prototype.fulfill_=function(a){this.settle_(1,a)};h.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};h.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var x=new a;h.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};h.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(q){c.reject(q)}};h.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{q(a(b))}catch(u){d(u)}}:b}var q,d,w=new h(function(a,b){q=a;d=b});this.callWhenSettled_(c(a,q),
c(b,d));return w};h.prototype["catch"]=function(a){return this.then(void 0,a)};h.prototype.callWhenSettled_=function(a,b){function c(){switch(h.state_){case 1:a(h.result_);break;case 2:b(h.result_);break;default:throw Error("Unexpected state: "+h.state_);}}var h=this;null==this.onSettledCallbacks_?x.asyncExecute(c):this.onSettledCallbacks_.push(function(){x.asyncExecute(c)})};h.resolve=function(a){return a instanceof h?a:new h(function(b,c){b(a)})};h.reject=function(a){return new h(function(b,c){c(a)})};
h.race=function(a){return new h(function(b,c){for(var q=$jscomp.makeIterator(a),d=q.next();!d.done;d=q.next())h.resolve(d.value).callWhenSettled_(b,c)})};h.all=function(a){var b=$jscomp.makeIterator(a),c=b.next();return c.done?h.resolve([]):new h(function(a,d){function w(b){return function(c){e[b]=c;q--;0==q&&a(e)}}var e=[],q=0;do e.push(void 0),q++,h.resolve(c.value).callWhenSettled_(w(e.length-1),d),c=b.next();while(!c.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(h.$jscomp$new$AsyncExecutor=function(){return new a});
return h},"es6-impl","es3");$jscomp.findInternal=function(c,a,b){c instanceof String&&(c=String(c));for(var h=c.length,x=0;x<h;x++){var U=c[x];if(a.call(b,U,x,c))return{i:x,v:U}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");$jscomp.polyfill("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(a,b,c){var h=this.length||0;0>b&&(b=Math.max(0,h+b));if(null==c||c>h)c=h;c=Number(c);0>c&&(c=Math.max(0,h+c));for(b=Number(b||0);b<c;b++)this[b]=a;return this}},"es6-impl","es3");var kUtil=kUtil||{};Math.sign||(Math.sign=function(c){return 0<c?1:0==c?0>1/c?-0:0:0>c?-1:NaN});kUtil.Matrix=function(c,a,b,h,x,U){this.a=c;this.b=a;this.c=b;this.d=h;this.e=x;this.f=U};
kUtil.Matrix.dot=function(c,a){return new kUtil.Matrix(c.a*a.a+c.c*a.b,c.b*a.a+c.d*a.b,c.a*a.c+c.c*a.d,c.b*a.c+c.d*a.d,c.a*a.e+c.c*a.f+c.e,c.b*a.e+c.d*a.f+c.f)};kUtil.Matrix.prototype.dot=function(c){return kUtil.Matrix.dot(this,c)};kUtil.Matrix.equals=function(c,a){return c.a==a.a&&c.b==a.b&&c.c==a.c&&c.d==a.d&&c.e==a.e&&c.f==a.f};kUtil.Matrix.prototype.equals=function(c){return kUtil.Matrix.equals(this,c)};
kUtil.Matrix.prototype.inversion=function(){var c=this.a,a=this.b,b=this.c,h=this.d,x=this.e,U=this.f,D=c*h-a*b;return new kUtil.Matrix(h/D,-a/D,-b/D,c/D,(b*U-h*x)/D,(a*x-c*U)/D)};kUtil.convertURLToBlob=function(c,a){var b=new XMLHttpRequest;b.open("GET",c,!0);b.responseType="blob";b.onloadend=function(){a(this.response)};b.send()};kUtil.convertBase64ToBlob=function(c,a){for(var b=atob(c),h=Array(b.length),x=0;x<b.length;++x)h[x]=b.charCodeAt(x);b=new Uint8Array(h);return new Blob([b],{type:a})};
Date.prototype.kUtilFormat=function(c){var a={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"h+":this.getUTCHours(),"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),S:this.getUTCMilliseconds()};/(y+)/.test(c)&&(c=c.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var b in a)(new RegExp("("+b+")")).test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?a[b]:("00"+a[b]).substr((""+a[b]).length)));return c};
kUtil.copyToClipBoard=function(c){if(navigator.clipboard)navigator.clipboard.writeText(c)["catch"](function(a){alert("copy failed, info: "+(a.message||a))});else{var a=document.createElement("textarea");a.style.width="4px";a.style.height="4px";a.style.position="fixed";a.style.left="0";a.style.top="0";jQuery(document.body).append(a);a.value=c;a.focus();a.select();try{document.execCommand("copy")||alert("copy failed")}catch(b){alert("copy failed, info: "+(b.message||b))}jQuery(a).remove()}};
(function(c){c.fn.borderWidth=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("border-left-width"):a.getAttribute("border-left-width"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("border-top-width"):a.getAttribute("border-top-width"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("border-right-width"):a.getAttribute("border-right-width"))||0;b.bottom=parseFloat(a.getPropertyValue?
a.getPropertyValue("border-bottom-width"):a.getAttribute("border-bottom-width"))||0;return b};c.fn.padding=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-left"):a.getAttribute("padding-left"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-top"):a.getAttribute("padding-top"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-right"):a.getAttribute("padding-right"))||
0;b.bottom=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-bottom"):a.getAttribute("padding-bottom"))||0;return b};c.fn.borderBoxRect=function(){var a=null;window.getComputedStyle&&(a=getComputedStyle(this[0]));var b=this.offset(),c={};c.pageX0=b.left;c.pageY0=b.top;c.width=a?parseFloat(a.width):this.outerWidth();c.height=a?parseFloat(a.height):this.outerHeight();c.pageX1=c.pageX0+c.width;c.pageY1=c.pageY0+c.height;return c};c.fn.paddingBoxRect=function(){var a=this.borderBoxRect(),b=this.borderWidth(),
c={};c.pageX0=a.pageX0+b.left;c.pageY0=a.pageY0+b.top;c.width=window.getComputedStyle?a.width-(b.left+b.right):this.innerWidth();c.height=window.getComputedStyle?a.height-(b.top+b.bottom):this.innerHeight();c.pageX1=a.pageX1-b.right;c.pageY1=a.pageY1-b.bottom;return c};c.fn.contentBoxRect=function(){var a=this.paddingBoxRect(),b=this.padding(),c={};c.pageX0=a.pageX0+b.left;c.pageY0=a.pageY0+b.top;c.width=window.getComputedStyle?a.width-(b.left+b.right):this.width();c.height=window.getComputedStyle?
a.height-(b.top+b.bottom):this.height();c.pageX1=a.pageX1-b.right;c.pageY1=a.pageY1-b.bottom;return c};c.fn.getTransform=function(){var a=this.css("transform");if("none"==a||""==a)a=this[0].style.transform;var b="matrix(",c=a.indexOf(b);if(-1!=c){c+=b.length;a=a.substring(c,a.indexOf(")",c)).split(",");for(b=0;b<a.length;++b)a[b]=parseFloat(a[b]);return new kUtil.Matrix(a[0],a[1],a[2],a[3],a[4],a[5])}b="scale(";c=a.indexOf(b);return-1!=c?(c+=b.length,a=parseFloat(a.substring(c)),new kUtil.Matrix(a,
0,0,a,0,0)):new kUtil.Matrix(1,0,0,1,0,0)};c.fn.setTransform=function(a){a="matrix("+[a.a,a.b,a.c,a.d,a.e,a.f].join()+")";this.css("transform",a)}})(jQuery);var TaskQueue=function(){this._queue=[];this.isWorking=!1;this.timeout=100};TaskQueue.prototype.push=function(c,a,b){this._queue.push({task:c,context:a,args:b});this.isWorking||this.next()};TaskQueue.prototype.unshift=function(c,a,b){this._queue.unshift({task:c,context:a,args:b});this.isWorking||this.next()};
TaskQueue.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var c=this._queue.shift(),a=c.task,b=c.context?c.context:self,h=c.args?c.args:[];setTimeout(function(){a.apply(b,h)},this.timeout)}};
(function(){function c(a,b){b||a.match(/^data\:([^\;]+)\;base64,/mi);a=a.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var c=atob(a),d=c.length,f=new ArrayBuffer(d),C=new Uint8Array(f),e=0;e<d;e++)C[e]=c.charCodeAt(e);return f}function a(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(a){200!=this.status&&0!==this.status||b(this.response)};c.send()}function b(b,d){function f(a){var c=h(a),z;a:if(z=new DataView(a),255!=z.getUint8(0)||216!=z.getUint8(1))z=!1;
else{for(var r=2,A=a.byteLength;r<A;){var f=z,e=r;if(56===f.getUint8(e)&&66===f.getUint8(e+1)&&73===f.getUint8(e+2)&&77===f.getUint8(e+3)&&4===f.getUint8(e+4)&&4===f.getUint8(e+5)){f=z.getUint8(r+7);0!==f%2&&(f+=1);0===f&&(f=4);var A=r+8+f,r=z.getUint16(r+6+f),C,E;z=A;A=new DataView(a);f={};for(e=z;e<z+r;)28===A.getUint8(e)&&2===A.getUint8(e+1)&&(C=A.getUint8(e+2),C in R&&(E=A.getInt16(e+3),C=R[C],E=D(A,e+5,E),f.hasOwnProperty(C)?f[C]instanceof Array?f[C].push(E):f[C]=[f[C],E]:f[C]=E)),e++;z=f;break a}r++}z=
void 0}var Q;a:if("DOMParser"in self)if(r=new DataView(a),255!=r.getUint8(0)||216!=r.getUint8(1))Q=!1;else{A=2;f=a.byteLength;for(a=new DOMParser;A<f-4;)if("http"==D(r,A,4)){f=A-1;A=r.getUint16(A-2)-1;r=D(r,f,A);A=r.indexOf("xmpmeta>")+8;r=r.substring(r.indexOf("<x:xmpmeta"),A);A=r.indexOf("x:xmpmeta")+10;r=r.slice(0,A)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
r.slice(A);b:{a=a.parseFromString(r,"text/xml");try{r={};if(0<a.children.length)for(A=0;A<a.children.length;A++){var T=a.children.item(A),w=T.attributes,q;for(q in w){var v=w[q],u=v.nodeName,B=v.nodeValue;void 0!==u&&(r[u]=B)}var p=T.nodeName;if("undefined"==typeof r[p])r[p]=xml2json(T);else{if("undefined"==typeof r[p].push){var l=r[p];r[p]=[];r[p].push(l)}r[p].push(xml2json(T))}}else r=a.textContent;Q=r;break b}catch(g){console.log(g.message)}Q=void 0}break a}else A++;Q=void 0}else Q=void 0;b.exifdata=
c||{};b.iptcdata=z||{};b.xmpdata=Q||{};d&&d.call(b)}if(b.src)if(/^data\:/i.test(b.src)){var C=c(b.src);f(C)}else if(/^blob\:/i.test(b.src)){var e=new FileReader;e.onload=function(a){f(a.target.result)};a(b.src,function(a){e.readAsArrayBuffer(a)})}else{var E=new XMLHttpRequest;E.onload=function(){if(200==this.status||0===this.status)f(E.response);else throw"Could not load image";E=null};E.open("GET",b.src,!0);E.responseType="arraybuffer";E.send(null)}else self.FileReader&&(b instanceof self.Blob||
b instanceof self.File)&&(e=new FileReader,e.onload=function(a){f(a.target.result)},e.readAsArrayBuffer(b))}function h(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var c=2;a=a.byteLength;for(var f;c<a;){if(255!=b.getUint8(c))return!1;f=b.getUint8(c+1);if(225==f)return W(b,c+4,b.getUint16(c+2)-2);c+=2+b.getUint16(c+2)}}function x(a,b,c,d,e){var f=a.getUint16(c,!e),C={},G,z,r;for(r=0;r<f;r++)G=c+12*r+2,z=d[a.getUint16(G,!e)],C[z]=U(a,G,b,c,e);return C}function U(a,b,c,
d,e){var f=a.getUint16(b+2,!e);d=a.getUint32(b+4,!e);c=a.getUint32(b+8,!e)+c;var h,G;switch(f){case 1:case 7:if(1==d)return a.getUint8(b+8,!e);c=4<d?c:b+8;b=[];for(f=0;f<d;f++)b[f]=a.getUint8(c+f);return b;case 2:return D(a,4<d?c:b+8,d-1);case 3:if(1==d)return a.getUint16(b+8,!e);c=2<d?c:b+8;b=[];for(f=0;f<d;f++)b[f]=a.getUint16(c+2*f,!e);return b;case 4:if(1==d)return a.getUint32(b+8,!e);b=[];for(f=0;f<d;f++)b[f]=a.getUint32(c+4*f,!e);return b;case 5:if(1==d)return h=a.getUint32(c,!e),G=a.getUint32(c+
4,!e),a=new Number(h/G),a.numerator=h,a.denominator=G,a;b=[];for(f=0;f<d;f++)h=a.getUint32(c+8*f,!e),G=a.getUint32(c+4+8*f,!e),b[f]=new Number(h/G),b[f].numerator=h,b[f].denominator=G;return b;case 9:if(1==d)return a.getInt32(b+8,!e);b=[];for(f=0;f<d;f++)b[f]=a.getInt32(c+4*f,!e);return b;case 10:if(1==d)return a.getInt32(c,!e)/a.getInt32(c+4,!e);b=[];for(f=0;f<d;f++)b[f]=a.getInt32(c+8*f,!e)/a.getInt32(c+4+8*f,!e);return b}}function D(a,b,c){for(var d="",f=b;f<b+c;f++)d+=String.fromCharCode(a.getUint8(f));
return d}function W(a,b){if("Exif"!=D(a,b,4))return!1;var c,d,f,h,q=b+6;if(18761==a.getUint16(q))c=!1;else if(19789==a.getUint16(q))c=!0;else return!1;if(42!=a.getUint16(q+2,!c))return!1;var G=a.getUint32(q+4,!c);if(8>G)return!1;d=x(a,q,q+G,e,c);if(d.ExifIFDPointer)for(f in h=x(a,q,q+d.ExifIFDPointer,w,c),h){switch(f){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":h[f]=
u[f][h[f]];break;case "ExifVersion":case "FlashpixVersion":h[f]=String.fromCharCode(h[f][0],h[f][1],h[f][2],h[f][3]);break;case "ComponentsConfiguration":h[f]=u.Components[h[f][0]]+u.Components[h[f][1]]+u.Components[h[f][2]]+u.Components[h[f][3]]}d[f]=h[f]}if(d.GPSInfoIFDPointer)for(f in h=x(a,q,q+d.GPSInfoIFDPointer,y,c),h){switch(f){case "GPSVersionID":h[f]=h[f][0]+"."+h[f][1]+"."+h[f][2]+"."+h[f][3]}d[f]=h[f]}G=q+G;f=a.getUint16(G,!c);if(G=a.getUint32(G+2+12*f,!c))if(G>a.byteLength)q={};else{G=
x(a,q,q+G,v,c);if(G.Compression)switch(G.Compression){case 6:G.JpegIFOffset&&G.JpegIFByteCount&&(G.blob=new Blob([new Uint8Array(a.buffer,q+G.JpegIFOffset,G.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",G.Compression)}else 2==G.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");q=G}else q={};d.thumbnail=q;return d}
var q=self,d=function(a){if(a instanceof d)return a;if(!(this instanceof d))return new d(a);this.EXIFwrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=d),exports.EXIF=d):q.EXIF=d;var w=d.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",
36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",
41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",
42016:"ImageUniqueID"},e=d.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",
301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},y=d.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",
16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},v=d.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",
278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},u=d.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",
2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",
24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",
32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",
95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},
GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},R={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",
105:"headline",116:"copyright",15:"category"};d.getData=function(a,c){if((self.Image&&a instanceof self.Image||self.HTMLImageElement&&a instanceof self.HTMLImageElement)&&!a.complete)return!1;a.exifdata?c&&c.call(a):b(a,c);return!0};d.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};d.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};d.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};d.getAllIptcTags=
function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};d.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};d.readFromBinaryFile=function(a){return h(a)};"function"===typeof define&&define.amd&&define("exif-js",
[],function(){return d})}).call(this);
(function(c){function a(){for(var a=0;a<E.length;a++)E[a][0](E[a][1]);E=[];ba=!1}function b(b,c){E.push([b,c]);ba||(ba=!0,T(a,0))}function h(a,b){function c(a){D(b,a)}function z(a){q(b,a)}try{a(c,z)}catch(ca){z(ca)}}function x(a){var b=a.owner,c=b.state_,b=b.data_,d=a[c];a=a.then;if("function"===typeof d){c=C;try{b=d(b)}catch(ca){q(a,ca)}}U(a,b)||(c===C&&D(a,b),c===Q&&q(a,b))}function U(a,b){var c;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(b&&("function"===
typeof b||"object"===typeof b)){var d=b.then;if("function"===typeof d)return d.call(b,function(d){c||(c=!0,b!==d?D(a,d):W(a,d))},function(b){c||(c=!0,q(a,b))}),!0}}catch(ca){return c||q(a,ca),!0}return!1}function D(a,b){a!==b&&U(a,b)||W(a,b)}function W(a,c){a.state_===R&&(a.state_=f,a.data_=c,b(w,a))}function q(a,c){a.state_===R&&(a.state_=f,a.data_=c,b(e,a))}function d(a){var b=a.then_;a.then_=void 0;for(a=0;a<b.length;a++)x(b[a])}function w(a){a.state_=C;d(a)}function e(a){a.state_=Q;d(a)}function y(a){if("function"!==
typeof a)throw new TypeError("Promise constructor takes a function argument");if(!1===this instanceof y)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[];h(a,this)}var v=c.Promise,u=v&&"resolve"in v&&"reject"in v&&"all"in v&&"race"in v&&function(){var a;new v(function(b){a=b});return"function"===typeof a}();"undefined"!==typeof exports&&exports?(exports.Promise=u?v:y,exports.Polyfill=y):"function"==
typeof define&&define.amd?define(function(){return u?v:y}):u||(c.Promise=y);var R="pending",f="sealed",C="fulfilled",Q="rejected",X=function(){},T="undefined"!==typeof setImmediate?setImmediate:setTimeout,E=[],ba;y.prototype={constructor:y,state_:R,then_:null,data_:void 0,then:function(a,c){var d={owner:this,then:new this.constructor(X),fulfilled:a,rejected:c};this.state_===C||this.state_===Q?b(x,d):this.then_.push(d);return d.then},"catch":function(a){return this.then(null,a)}};y.all=function(a){if("[object Array]"!==
Object.prototype.toString.call(a))throw new TypeError("You must pass an array to Promise.all().");return new this(function(b,c){function d(a){z++;return function(c){e[a]=c;--z||b(e)}}for(var e=[],z=0,r=0,f;r<a.length;r++)(f=a[r])&&"function"===typeof f.then?f.then(d(r),c):e[r]=f;z||b(e)})};y.race=function(a){if("[object Array]"!==Object.prototype.toString.call(a))throw new TypeError("You must pass an array to Promise.race().");return new this(function(b,c){for(var d=0,e;d<a.length;d++)(e=a[d])&&"function"===
typeof e.then?e.then(b,c):b(e)})};y.resolve=function(a){return a&&"object"===typeof a&&a.constructor===this?a:new this(function(b){b(a)})};y.reject=function(a){return new this(function(b,c){c(a)})}})("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
var KPainter=function(c){var a=this;c=c||{};KPainter.xxx="mouse"==c.gesturer?!1:"touch"==c.gesturer?!0:"ontouchend"in document?!0:!1;var b=jQuery,h=function(a,b,c){return new Promise(function(d){if(a.toBlob)a.toBlob(function(a){d(a)},b,c);else{var e=a.toDataURL(b,c),e=kUtil.convertBase64ToBlob(e.substring(e.indexOf(",")+1),b);d(e)}})},x=function(a,b,c){b=b||new kUtil.Matrix(1,0,0,1,0,0);var d=document.createElement("canvas"),e=!1;0!=b.a*b.d&&0==b.b*b.c?(d.width=a.naturalWidth||a.width,d.height=a.naturalHeight||
a.height):(e=!0,d.width=a.naturalHeight||a.height,d.height=a.naturalWidth||a.width);if(d.width>c||d.height>c)c/=Math.max(d.width,d.height),d.width=Math.min(d.width*c),d.height=Math.min(d.height*c);c=d.getContext("2d");c.setTransform(b.a,b.b,b.c,b.d,b.e*d.width,b.f*d.height);e?c.drawImage(a,0,0,d.height,d.width):c.drawImage(a,0,0,d.width,d.height);return d},U=function(a,b,c){return new Promise(function(d){var e=function(){var e=URL.createObjectURL(a),f=new Image;f.onload=f.onerror=function(){f.onload=
f.onerror=null;var a=x(f,b,c);URL.revokeObjectURL(e);d(a)};f.src=e};window.createImageBitmap?createImageBitmap(a).then(function(a){d(x(a,b,c))})["catch"](function(){e()}):e()})},D=KPainter._doCallbackNoBreak,W=b('<div style="width:800px;height:600px;border:1px solid #ccc;"><div class="kPainterBox"><div class="kPainterImgsDiv"><canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas></div><div class="kPainterCroper" style="width:50px;height:50px;display:none;"><div class="kPainterCells"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div><div class="kPainterEdges"><div data-orient="-1,0"></div><div data-orient="0,-1"></div><div data-orient="1,0"></div><div data-orient="0,1"></div></div><div class="kPainterCorners"><div data-orient="-1,-1"><i></i></div><div data-orient="1,-1"><i></i></div><div data-orient="1,1"><i></i></div><div data-orient="-1,1"><i></i></div></div><div class="kPainterMover" data-orient="0,0"><div></div><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg></div></div><div class="kPainterPerspect" style="display:none;"><canvas class="kPainterPerspectCvs"></canvas><div class="kPainterPerspectCorner" data-index="0">lt</div><div class="kPainterPerspectCorner" data-index="1">rt</div><div class="kPainterPerspectCorner" data-index="2">rb</div><div class="kPainterPerspectCorner" data-index="3">lb</div></div><div class="kPainterGesturePanel"></div></div></div>')[0],
q=b(W).children(),d=q.find("> .kPainterImgsDiv > .kPainterCanvas")[0];a.getHtmlElement=function(){return W};var w=-1,e=[],y=null,v=null,u=!1,R="view";a.getCurIndex=function(){return w};a.getCount=function(){return e.length};a.isEditing=function(){return u};a.getMode=function(){return R};a.getImage=function(a,c){void 0==c&&(c=w);if(!(isNaN(c)||(c=Math.round(c),0>c||c>=e.length))){var d;a?d=e[c]:(d=b(e[c]).clone()[0],d.setAttribute("style",""));return d}};a.onStartLoading=null;a.onFinishLoading=null;
var f=function(){D(a.onStartLoading)},C=function(){D(a.onFinishLoading)},Q=new function(){a.defaultFileInput=b('<input type="file" accept="image/bmp,image/gif,image/jpeg,image/png,image/webp" multiple style="display:none">')[0];a.beforeAddImgFromFileChooseWindow=null;a.afterAddImgFromFileChooseWindow=null;b(a.defaultFileInput).change(function(b){var g=this;b=b.originalEvent;var c=function(b){d(b).then(function(b){D(a.afterAddImgFromFileChooseWindow,[!0,b]);g.value=""},function(b){D(a.afterAddImgFromFileChooseWindow,
[!1,b]);g.value=""})};a.beforeAddImgFromFileChooseWindow?D(a.beforeAddImgFromFileChooseWindow,[b,function(a){c(a)}]):c(g.files)});a.showFileChooseWindow=function(){if(u)return!1;a.defaultFileInput.click();return!0};a.beforeAddImgFromDropFile=null;a.afterAddImgFromDropFile=null;q.on("dragover",function(a){a=a.originalEvent;a.stopPropagation();a.preventDefault()});q.on("drop",function(b){b=b.originalEvent;b.stopPropagation();b.preventDefault();var g=function(b){d(b).then(function(b){D(a.afterAddImgFromDropFile,
[!0,b])},function(b){D(a.afterAddImgFromDropFile,[!1,b])})};a.beforeAddImgFromDropFile?D(a.beforeAddImgFromDropFile,[b,function(a){g(a)}]):g(b.dataTransfer.files)});var c=new TaskQueue,d=a.addImage=function(a){return new Promise(function(b,l){if(u)return l(Error("`addImage(imgData)`: The function is only valid in `view` mode."));if(!(a instanceof Blob||a instanceof HTMLCanvasElement||"string"==typeof a||a instanceof String||a instanceof HTMLImageElement)){if(a instanceof Array||a instanceof FileList){for(var g=
[],n=!1,m=0;m<a.length;++m)d(a[m]).then(function(c){g.push(c);n=!0;g.length==a.length&&b(g)},function(c){g.push(c);g.length==a.length&&(n?b(g):(Error("`addImage(imgData)`: No img added in this array. Get more info in `<this error object>.addImgErrArr`.").addImgErrArr=g,l(Error("`addImage(imgData)`: No img added in this array."))))});return}return l(Error("`addImage(imgData)`: Type of `imgData` should be `Blob`, `HTMLCanvasElement`, `HTMLImageElement`, `String(url)`, `Array(a array of source)`, `FileList`."))}f();
c.push(y,null,[a,function(a){a instanceof Error?l(Error("`addImage(imgData)`: "+a)):b(a);c.next();c.isWorking||C()}])})},r=function(a,b){"image/jpeg"!=a.type?b(null):EXIF.getData(a,function(){var a=null;switch(EXIF.getTag(this,"Orientation")){case 6:a=new kUtil.Matrix(0,1,-1,0,1,0);break;case 3:a=new kUtil.Matrix(-1,0,0,-1,1,1);break;case 8:a=new kUtil.Matrix(0,-1,1,0,0,1)}b(a)})},A=function(a,b){var g=a.slice(25,26),c=new FileReader;c.onload=function(){var a=(new Int8Array(c.result))[0];b(4==(a&
4))};c.readAsArrayBuffer(g)},v=function(a,b){var c=a.type;-1!=c.indexOf("webp")?b&&b("image/webp"):-1!=c.indexOf("gif")||-1!=c.indexOf("svg")?b&&b("image/png"):-1!=c.indexOf("png")?A(a,function(a){b&&b(a?"image/png":"image/jpeg")}):b&&b("image/jpeg")},y=function(a,b){K(a,function(a,c){a instanceof Blob?D(function(){O(a,c,b)}):b(a)})},K=this.getBlobAndFormatFromAnyImgData=function(a,b){var c=function(a){v(a,function(c){r(a,function(g){H(a,g,c,function(a){b(a,c)})})})};if(a instanceof Blob)c(a);else if(a instanceof
HTMLCanvasElement)h(a).then(c);else if("string"==typeof a||a instanceof String)if("data:"==a.substring(0,5)){var g="";"image/"==a.substring(5,11)&&(g=a.substring(5,a.indexOf(";",11)));g=kUtil.convertBase64ToBlob(a.substring(a.indexOf("base64,")+7),g);c(g)}else kUtil.convertURLToBlob(a,function(a){a?c(a):b("Network error.")});else if(a instanceof HTMLImageElement)if(a.crossOrigin&&"anonymous"!=a.crossOrigin)b("Cors error.");else{var l=a.src;K(l,function(g,k){if(g instanceof Blob)b(g,k);else{var n=
document.createElement("canvas");n.width=a.naturalWidth;n.height=a.naturalHeight;n.getContext("2d").drawImage(a,0,0);var d="",m=l.lastIndexOf("?"),t;-1!=m?(t=l.lastIndexOf(".",m),-1!=t&&5>=m-t&&(d=l.substring(t+1,m))):(t=l.lastIndexOf("."),-1!=t&&(d=5>=l.length-t?l.substring(t+1):l.substring(t+1,t+5)));d=-1!=d.indexOf("webp")?"image/webp":-1!=d.indexOf("png")||-1!=d.indexOf("gif")||-1!=d.indexOf("svg")?"image/png":"image/jpeg";h(n,d).then(c)}})}else b("Type of `imgData` not support.")};a.addedImageMaxWH=
4096;var H=function(a,b,c,k){b?U(a,b).then(function(a){h(a,c).then(function(a){k&&k(a)})}):k&&k(a)};a.isShowNewImgWhenAdd=!0;var O=function(c,g,n){var l=new Image;l.kPainterOriBlob=l.kPainterBlob=c;l.kPainterSaveFormat=g;var d=URL.createObjectURL(l.kPainterBlob);l.onload=l.onerror=function(){a._noAnyUseButForIosSafariBug0=l.naturalWidth;a._noAnyUseButForIosSafariBug1=l.naturalHeight;l.kPainterWidth=l.naturalWidth;l.kPainterHeight=l.naturalHeight;l.kPainterOriWidth=l.kPainterWidth;l.kPainterOriHeight=
l.kPainterHeight;if(l.kPainterWidth>a.addedImageMaxWH||l.kPainterHeight>a.addedImageMaxWH)h(x(l,null,a.addedImageMaxWH),g).then(function(a){URL.revokeObjectURL(d);l.kPainterOriBlob=l.kPainterBlob=a;d=URL.createObjectURL(l.kPainterBlob);l.src=d});else{l.onload=l.onerror=null;(a.isShowNewImgWhenAdd||-1==w)&&F(e.length-1);try{(function(){for(var a=0;a<m.length;++a){var b=m[a].cvs,c=m[a].mwh,c=Math.min(c/l.naturalWidth,c/l.naturalHeight,1);b.width=Math.round(l.naturalWidth*c);b.height=Math.round(l.naturalHeight*
c);b.getContext("2d").drawImage(l,0,0,b.width,b.height)}})()}catch(J){setTimeout(function(){throw J;},0)}n&&n(e.length-1)}};l.src=d;b(l).hide();q.children(".kPainterImgsDiv").append(l);e.push(l);var m=[];try{(function(){for(var a=0;a<p.length;++a){var b=p[a],c=b.kPainterFunWrap,g=document.createElement("canvas");g.className="kPainterThumbnailCanvas";m.push({cvs:g,mwh:b.kPainterMaxWH});var l=null;try{l=c?c(g):g}catch(V){setTimeout(function(){throw V;},0);break}l&&(l.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},
b.kPainterThumbBoxArr.push(l),b.appendChild(l))}})()}catch(J){setTimeout(function(){throw J;},0)}},E=function(){var b=e[w],c=q;c.paddingBoxRect();var c=c.contentBoxRect(),d=b.kPainterZoom=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight);b.style.width=(Math.round(b.kPainterWidth*d)||1)+"px";b.style.height=(Math.round(b.kPainterHeight*d)||1)+"px";b.style.left=b.style.right=b.style.top=b.style.bottom="-100000px";if(2<=e.length){var k=e[(e.length+w-1)%e.length],d=Math.min(c.width/k.kPainterWidth,
c.height/k.kPainterHeight);k.style.width=(Math.round(k.kPainterWidth*d)||1)+"px";k.style.height=(Math.round(k.kPainterHeight*d)||1)+"px";k.style.right="100000px";k.style.left=k.style.top=k.style.bottom="-100000px"}3<=e.length&&(b=e[(e.length+w+1)%e.length],d=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight),b.style.width=(Math.round(b.kPainterWidth*d)||1)+"px",b.style.height=(Math.round(b.kPainterHeight*d)||1)+"px",b.style.left="100000px",b.style.right=b.style.top=k.style.bottom="-100000px");
D(a.onUpdateImgPosZoom)},N=null,P=null,I;a.updateUIOnResize=function(b){null!=N&&(clearTimeout(N),N=null,P());return b?new Promise(function(b,c){I=u;N=setTimeout(function(){if(-1!=w&&I==u)if(u){var c=a.getFreeTransformCornerPos();X.setImgStyleFit();a.setFreeTransformCornerPos(c)}else E();N=null;b()},500);P=c}):-1!=w?(u?(b=a.getFreeTransformCornerPos(),X.setImgStyleFit(),a.setFreeTransformCornerPos(b)):E(),!0):!1};var F=this.showImg=function(c){var g=e[c];b(g).siblings().hide();w=c;b(g).show();2<=
e.length&&(0<c||a.allowedTouchMoveSwitchImgOverBoundary)&&b(e[(e.length+c-1)%e.length]).show();3<=e.length&&(c<e.length-1||a.allowedTouchMoveSwitchImgOverBoundary)&&b(e[(e.length+c+1)%e.length]).show();E();B()};a.onNumChange=null;var B=function(){var b=void 0,c=void 0;return function(){if(b!=w||c!=e.length)b=w,c=e.length,D(a.onNumChange,[w,e.length])}}();a.changePage=function(a){if(u)return!1;var b;switch(a){case "f":b=0;break;case "p":b=w-1;break;case "n":b=w+1;break;case "l":b=e.length-1;break;
default:if(1>arguments.length||isNaN(a))return!1;b=Math.round(a)}if(0>b||b>=e.length||b==w)return!1;F(b);return!0};a.movePage=function(){if(u)return!1;var a,c;1==arguments.length?c=arguments[0]:2<=arguments.length&&(a=arguments[0],c=arguments[1]);void 0==a&&(a=w);if(isNaN(c))return!1;c=Math.round(c);if(0>c||c>e.length||isNaN(a))return!1;a=Math.round(a);if(0>a||a>=e.length)return!1;if(a==c)return!0;var d=e.splice(a,1)[0];c>a?e.splice(c-1,0,d):e.splice(c,0,d);a==w?w=c>a?c-1:c:a<w&&c>w?--w:a>w&&c<w&&
++w;B();try{for(d=0;d<p.length;++d){var k=p[d],t=k.kPainterThumbBoxArr[a];k.kPainterThumbBoxArr.length==c?b(k).append(t):b(k.kPainterThumbBoxArr[c]).before(t);k.kPainterThumbBoxArr.splice(a,1);c>a?k.kPainterThumbBoxArr.splice(c-1,0,t):k.kPainterThumbBoxArr.splice(c,0,t)}}catch(m){setTimeout(function(){throw m;},0)}return!0};a.del=function(a){if(u)return!1;1>arguments.length&&(a=w);if(isNaN(a))return!1;a=Math.round(a);if(0>a||a>=e.length)return!1;URL.revokeObjectURL(e[a].src);b(e[a]).remove();e.splice(a,
1);try{for(var c=0;c<p.length;++c){var d=p[c];b(d.kPainterThumbBoxArr[a]).remove();d.kPainterThumbBoxArr.splice(a,1)}}catch(k){setTimeout(function(){throw k;},0)}a<w?(--w,B()):a==w?(w==e.length&&--w,0<=w?F(w):B()):B();return!0};a.getWidth=function(a){1>arguments.length&&(a=w);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=e.length?NaN:e[a].kPainterWidth};a.getHeight=function(a){1>arguments.length&&(a=w);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=e.length?NaN:e[a].kPainterHeight};
a.getBlob=function(a){1>arguments.length&&(a=w);if(isNaN(a))return null;a=Math.round(a);return 0>a||a>=e.length?null:e[a].kPainterBlob};a.download=function(a,b){2>arguments.length&&(b=w);if(isNaN(b))return null;b=Math.round(b);if(0>b||b>=e.length)return null;var c=document.createElement("a");c.target="_blank";var g=e[b].kPainterBlob;if(!a){var d="";g.type&&(d=g.type.substring(g.type.indexOf("/")+1));d="jpeg"==d?".jpg":"."+d;a=(new Date).getTime()+d}c.download=a;var m=URL.createObjectURL(g);c.href=
m;g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});c.dispatchEvent(g);setTimeout(function(){URL.revokeObjectURL(m)},1E4);return a};var p=this.thumbnailBoxArr=[];a.bindThumbnailBox=function(b,c,d){if(u||!(b instanceof HTMLElement))return!1;a.unbindThumbnailBox(b);b.innerHTML="";b.kPainterFunWrap=c;b.kPainterMaxWH=d||256;b.kPainterThumbBoxArr=[];for(d=0;d<e.length;++d){var g=e[d];a._noAnyUseButForIosSafariBug0=g.naturalWidth;a._noAnyUseButForIosSafariBug1=g.naturalHeight;var n=Math.min(b.kPainterMaxWH/
g.naturalWidth,b.kPainterMaxWH/g.naturalHeight,1),m=document.createElement("canvas");m.width=Math.round(g.naturalWidth*n);m.height=Math.round(g.naturalHeight*n);m.getContext("2d").drawImage(g,0,0,m.width,m.height);m.className="kPainterThumbnailCanvas";g=null;try{g=c?c(m):m}catch(J){return setTimeout(function(){throw J;},0),!1}g&&(g.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(g),b.appendChild(g))}p.push(b);return!0};a.unbindThumbnailBox=function(a){if(u)return!1;
if(a){for(var b=0;b<p.length;++b)if(p[b]==a)return a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0,p.splice(b,1),!0;return!1}for(b=0;b<p.length;++b)a=p[b],a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0;p.length=0;return!0}};(function(a){a=a.length?a[0]:function(a){var b=a.indexOf(".");return[a.substring(b,b+32),a.substring(0,8)]}(location.host);for(var b=null,c=0;c<a.length;++c){for(var d=1,e=a[c],f=0;f<e.length;++f)d*=e.charCodeAt(f),d+=e.charCodeAt((f+
1)%e.length),d%=11003;if(1!=d&&7480!=d&&5095!=d&&3124!=d&&8633!=d&&3122!=d)b=setTimeout(function(){D=function(){}},1E5*(1+2*Math.random()));else{null!==b&&clearTimeout(b);break}}})(arguments);var X=new function(){var c=Number.NEGATIVE_INFINITY,f;a.leftDoubleClickZoomRate=2;a.rightDoubleClickZoomRate=.5;var h,A,x,C,K,H,O,S,N,P,I,F,B,p,l,g,n,k,t,m,J,L;a.allowedTouchMoveSwitchImgOverBoundary=!0;var aa=function(){if(-1!=w&&"posZoom"==y){y=v=null;q.find("> .kPainterCroper > .kPainterEdges").children().css("z-index",
1);q.find("> .kPainterCroper > .kPainterCorners").children().css("z-index",1);q.find("> .kPainterCroper > .kPainterMover").css("z-index",1);q.find("> .kPainterCroper > .kPainterBigMover").css("z-index",1);if(!u&&1!=e.length){var b=!1,d,n;1.2>m/J&&(b=!0,d=Math.sqrt(Math.pow(K-h,2)+Math.pow(H-A,2)),n=d/(((new Date).getTime()-c)/1E3));if(k<-(Math.round(g*m)||1)/2||b&&-50>d&&-200>n){if(w+1<e.length||a.allowedTouchMoveSwitchImgOverBoundary){Q.showImg((e.length+w+1)%e.length);return}}else if(k>(Math.round(g*
m)||1)/2||b&&50<d&&200<n)if(0<=w-1||a.allowedTouchMoveSwitchImgOverBoundary){Q.showImg((e.length+w-1)%e.length);return}}V();Y()}},M=function(a){var c=q;u?(p=d,g=p.width,n=p.height):(p=e[w],g=p.kPainterWidth,n=p.kPainterHeight);k=parseFloat(p.style.left)+1E5;t=parseFloat(p.style.top)+1E5;l=b(p).getTransform();if(0==l.a*l.d||0!=l.b*l.c){var Z=g;g=n;n=Z}m=p.kPainterZoom||1;F=c.paddingBoxRect();B=c.contentBoxRect();J=Math.min(B.width/g,B.height/n);u&&E.isCropRectShowing&&!a&&(a=E.getNeededRect(),J=Math.max(Math.max(a.width,
g*J)/g,Math.max(a.height,n*J)/n))};a.onUpdateImgPosZoom=null;var Y=function(){p.style.left=k-1E5+"px";p.style.right=-k-1E5+"px";p.style.top=t-1E5+"px";p.style.bottom=-t-1E5+"px";p.kPainterZoom=m;0!=l.a*l.d&&0==l.b*l.c?(p.style.width=(Math.round(g*m)||1)+"px",p.style.height=(Math.round(n*m)||1)+"px"):(p.style.height=(Math.round(g*m)||1)+"px",p.style.width=(Math.round(n*m)||1)+"px");if(!u&&1!=e.length){var b=Math.max(0,((Math.round(g*m)||1)-F.width)/2);if(2<e.length||k>b){var c=e[(e.length+w-1)%e.length];
c.style.left=k-b-F.width+"px";c.style.right=-k+b+F.width+"px"}if(2<e.length||k<=-b)c=e[(e.length+w+1)%e.length],c.style.left=k+b+F.width+"px",c.style.right=-k-b-F.width+"px"}D(a.onUpdateImgPosZoom)},V=function(a,b){4<m&&(m=4);m<J&&(m=J);if(!a){var c=Math.round(g*m)||1;B.width>c?k=0:(c=(c-B.width)/2,k<-c?k=-c:k>c&&(k=c))}b||(c=Math.round(n*m)||1,B.height>c?t=0:(c=(c-B.height)/2,t<-c?t=-c:t>c&&(t=c)))};a.getZoom=function(){if(0!=e.length)return M(),m};a.setZoom=function(a,b){if(0==e.length)return null;
a=parseFloat(a);if(a!==a)return null;M();m=b?m*a:a;V();Y();return m};this.setImgStyleFit=function(){M(!0);m=J;V();Y();a.setCropRectArea()};q.on("touchstart touchcancel touchend mousedown",function(b){b.preventDefault();if(-1!=w){var g=b.originalEvent;b=g.targetTouches;var d;if(!b){if(!v)v="mouse";else if("mouse"!=v)return;b=[{pageX:g.clientX,pageY:g.clientY}];d=g.buttons}else if(b.length)if(!v)v="touch";else if("touch"!=v)return;if(1==b.length){K=h=b[0].pageX;H=A=b[0].pageY;M();g=c;c=(new Date).getTime();
var n=f;f=d||(.01>Math.abs(m-J)/J?1:2);if(1E3>c-g&&f==n&&(1==f||2==f)&&8>Math.abs(b[0].pageX-x)&&8>Math.abs(b[0].pageY-C)){c=Number.NEGATIVE_INFINITY;d=K;var g=H,l=m,n=1==f?a.leftDoubleClickZoomRate:a.rightDoubleClickZoomRate;m*=n;4<m&&(m=4,n=4/l);m<J&&(m=J,n=J/l);l=t+F.pageY0+F.height/2;k-=(n-1)*(d-(k+F.pageX0+F.width/2));t-=(n-1)*(g-l);V()}null==y&&(y="posZoom",q.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),q.find("> .kPainterCroper > .kPainterCorners").children().css("z-index",
"unset"),q.find("> .kPainterCroper > .kPainterMover").css("z-index","unset"),q.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),L=b[0].identifier)}else 2==b.length?(K=h=b[0].pageX,H=A=b[0].pageY,null==y&&(y="posZoom"),"posZoom"==y&&(M(),q.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),q.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),q.find("> .kPainterCroper > .kPainterMover").css("z-index","unset"),q.find("> .kPainterCroper > .kPainterBigMover").css("z-index",
"unset"),N=b[1].pageX,P=b[1].pageY,O=(K+N)/2,S=(H+P)/2,I=Math.sqrt(Math.pow(K-N,2)+Math.pow(H-P,2)))):0==b.length&&(x=K,C=H,aa())}});q.on("mouseup",function(a){"mouse"==v&&(a=a.originalEvent,x=a.clientX,C=a.clientY,aa())});q.on("mouseleave",function(a){"mouse"==v&&a.originalEvent.buttons&&(x=K,C=H,aa())});q.on("contextmenu",function(a){a.preventDefault()});q.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if("mouse"!=v)return;b=[{pageX:a.originalEvent.clientX,
pageY:a.originalEvent.clientY}]}else if("touch"!=v)return;if(1==b.length){if("posZoom"==y&&L==b[0].identifier){a=K;var c=H;K=b[0].pageX;H=b[0].pageY;k+=K-a;t+=H-c;V(!u);Y()}}else if(2==b.length&&"posZoom"==y){a=O;var c=S,g=I,d=m;K=b[0].pageX;H=b[0].pageY;N=b[1].pageX;P=b[1].pageY;O=(K+N)/2;S=(H+P)/2;I=Math.sqrt(Math.pow(K-N,2)+Math.pow(H-P,2));b=I/g;m*=b;4<m&&(m=4,b=4/d);m<J&&(m=J,b=J/d);d=t+F.pageY0+F.height/2;k-=(b-1)*(a-(k+F.pageX0+F.width/2));t-=(b-1)*(c-d);V();Y()}})},T=new function(){var c=
this,z,r=[];a.stepImgsGCThreshold=10;var A=[],x=[];a.addProtectedStep=function(a){if(!u)return!1;a=parseInt(a);if(a!==a)return!1;if(-1!=x.indexOf(a))return!0;x.push(a);x.sort(function(a,b){return a-b});return!0};a.removeProtectedStep=function(a){if(!u)return!1;a=parseInt(a);if(a!==a)return!1;a=x.indexOf(a);if(-1==a)return!1;x.splice(a,1);return!0};a.getProtectedSteps=function(){return u?x.concat():null};var D=c.pushStack=function(b){r.length=z+1;for(var c=A.length-1;0<c;--c)if(A[c].beginStep>z)--A.length;
else break;var d;if(b.srcBlob){d={crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:b.srcBlob,saveFormat:b.saveFormat};for(c=0;A.length>=a.stepImgsGCThreshold;)if(x.filter(function(a){return A[c].beginStep<=a&&a<A[c].endStep}).length){if(!(++c<A.length))break}else{b=A[c].endStep;for(var g=A[c].beginStep;g<b;++g)r[g]=null;A.splice(c,1)}r.push(d);++z;A.push({blob:d.srcBlob,beginStep:z,endStep:z+1})}else{d=r[z];var n=d.crop,k=b.transform,t=b.crop,g={};b=k?k:d.transform;
g.left=n.left;g.top=n.top;g.width=n.width;g.height=n.height;0!=b.a*b.d&&0==b.b*b.c?(k&&(b=new kUtil.Matrix(Math.sign(k.a),0,0,Math.sign(k.d),0,0)),t&&(g.left=1==b.a?g.left+t.left*n.width:g.left+(1-t.left-t.width)*n.width,g.top=1==b.d?g.top+t.top*n.height:g.top+(1-t.top-t.height)*n.height,g.width*=t.width,g.height*=t.height)):(k&&(b=new kUtil.Matrix(0,Math.sign(k.b),Math.sign(k.c),0,0,0)),t&&(g.left=1==b.b?g.left+t.top*n.width:g.left+(1-t.top-t.height)*n.width,g.top=1==b.c?g.top+t.left*n.height:g.top+
(1-t.left-t.width)*n.height,g.width*=t.height,g.height*=t.width));n=e[w];n=Math.pow(10,Math.ceil(Math.max(n.kPainterWidth,n.kPainterHeight)).toString().length+2);g.left=Math.round(g.left*n)/n;g.top=Math.round(g.top*n)/n;g.width=Math.round(g.width*n)/n;g.height=Math.round(g.height*n)/n;d={crop:g,transform:b,srcBlob:d.srcBlob,saveFormat:d.saveFormat};r.push(d);++z;d.srcBlob&&(A[A.length-1].endStep=z+1)}};a.undo=function(){return new Promise(function(a,b){if(!u)return b(Error("`undo()`: The function is invalid in current mode."));
if(0<z){for(var c=z-1;null==r[c];)--c;K(z,c,function(){return a()})}})};a.redo=function(){return new Promise(function(a,b){if(!u)return b(Error("`undo()`: The function is invalid in current mode."));if(z<r.length-1){for(var c=z+1;null==r[c];)++c;K(z,c,function(){return a()})}})};a.getStepCount=function(){return u?r.length:NaN};a.getCurStep=function(){return u?z:NaN};a.setCurStep=function(a){return new Promise(function(b,c){if(1>arguments.length||isNaN(a))return c(Error("`setCurStep(index)`: The parameter `index` is invalid."));
a=Math.round(a);if(0>a||a>=r.length||null==r[a])return c(Error("`setCurStep(index)`: The parameter `index` is invalid."));K(z,a,function(){return b()})})};c.needAlwaysTrueTransform=!1;var K=function(a,e,l){z=e;e=r[a].crop;var g=r[z].crop;e.left==g.left&&e.top==g.top&&e.width==g.width&&e.bottom==g.bottom&&r[a].srcBlob==r[z].srcBlob?(b(d).setTransform(r[z].transform.dot(r[a].transform.inversion()).dot(b(d).getTransform())),X.setImgStyleFit(),l&&l()):S(c.needAlwaysTrueTransform,!1,l)},H=function(c){b(d).siblings().hide();
S(!1,!1,function(){a.isAutoShowCropUI&&E.showCropRect();c&&c()})},O;O=Math.min(screen.width,screen.height)*(window.devicePixelRatio||1);var S=c.updateCvsAsync=function(a,c,l){b(d).hide();var g=r[z],n=g.srcBlob||e[w].kPainterOriBlob,k=function(){var b=URL.createObjectURL(n),d=new Image;d.onload=d.onerror=function(){d.onload=d.onerror=null;N(d,g,a,c);URL.revokeObjectURL(b);l&&l()};d.src=b};window.createImageBitmap?createImageBitmap(n).then(function(b){N(b,g,a,c);l&&l()})["catch"](function(){k()}):k()},
N=function(c,e,l,g){a._noAnyUseButForIosSafariBug0=c.naturalWidth;a._noAnyUseButForIosSafariBug1=c.naturalHeight;var n=c.naturalWidth||c.width,k=c.naturalHeight||c.height,t=e.crop;e=e.transform;var m=d.getContext("2d"),f=d.fullQualityWidth=Math.round(n*t.width)||1,L=d.fullQualityHeight=Math.round(k*t.height)||1,h=!1;0!=e.a*e.d&&0==e.b*e.c?(d.fullQualityWidth=f,d.fullQualityHeight=L):(d.fullQualityWidth=L,d.fullQualityHeight=f,l&&(h=!0));d.hasCompressed=!1;if(l){var M,p;h?(M=L,p=f):(M=f,p=L);d.width=
M;d.height=p;m.setTransform(e.a,e.b,e.c,e.d,M/2*(1-e.a-e.c),p/2*(1-e.b-e.d))}else f>O||L>O?(M=O/Math.max(f,L),d.width=Math.round(f*M)||1,d.height=Math.round(L*M)||1,d.hasCompressed=!0):(d.width=f,d.height=L);M=Math.round(n*t.left);t=Math.round(k*t.top);M==n&&--M;t==k&&--t;h?(n=d.height,k=d.width):(n=d.width,k=d.height);if(2>=f/n)m.drawImage(c,M,t,f,L,0,0,n,k);else{h=document.createElement("canvas");h.width=Math.round(f/2);h.height=Math.round(L/2);p=h.getContext("2d");var V=Math.round(f/2),Z=Math.round(L/
2);for(p.drawImage(c,M,t,f,L,0,0,V,Z);;){c=V;f=Z;V=Math.round(c/2);Z=Math.round(f/2);if(V<=n||Z<=k)break;p.drawImage(h,0,0,c,f,0,0,V,Z)}m.drawImage(h,0,0,c,f,0,0,n,k)}l?b(d).setTransform(new kUtil.Matrix(1,0,0,1,0,0)):b(d).setTransform(e);g||(X.setImgStyleFit(),b(d).show())};a.enterEdit=function(){return new Promise(function(a,b){if(u)return b(Error("`enterEdit()`: The function is invalid in current mode."));if(-1==w)return b(Error("`enterEdit()`: There is no image in the instance."));R="";f();u=
!0;var c=e[w].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};r.push(c);z=0;H(function(){C();y=v=null;R="basicEdit";return a()})})};var P=a.cancelEdit=function(){if(!u)return!1;u=!1;r.length=0;A.length=0;Q.showImg(w);b(d).hide();E.hideCropRect();ba.hideFreeTransformBorderDirectly();y=v=null;R="view";return!0},I=function(a,c){var f=r[z].crop,g=r[z].transform,n=r[0].crop,k=r[0].transform,t=e[w];if(r[z].srcBlob||k.a!=g.a||k.b!=
g.b||k.c!=g.c||k.d!=g.d||Math.round(t.kPainterOriWidth*f.left)!=Math.round(t.kPainterOriWidth*n.left)||Math.round(t.kPainterOriHeight*f.top)!=Math.round(t.kPainterOriHeight*n.top)||Math.round(t.kPainterOriWidth*(f.left+f.width))!=Math.round(t.kPainterOriWidth*(n.left+n.width))||Math.round(t.kPainterOriHeight*(f.top+f.height))!=Math.round(t.kPainterOriHeight*(n.top+n.height))){URL.revokeObjectURL(t.src);var m=new Image,f=function(){m.onload=m.onerror=function(){m.onload=m.onerror=null;c?(b(e[w]).remove(),
e.splice(w,1,m)):e.splice(++w,0,m);q.children(".kPainterImgsDiv").append(m);a&&a()};h(d,r[z].saveFormat||t.kPainterSaveFormat).then(function(a){m.kPainterBlob=a;m.kPainterWidth=d.width;m.kPainterHeight=d.height;r[z].srcBlob?(m.kPainterOriBlob=a,m.kPainterOriWidth=d.width,m.kPainterOriHeight=d.height,m.kPainterSaveFormat=r[z].saveFormat):(m.kPainterOriBlob=t.kPainterOriBlob,m.kPainterOriWidth=t.kPainterOriWidth,m.kPainterOriHeight=t.kPainterOriHeight,m.kPainterProcess=r[z],m.kPainterSaveFormat=t.kPainterSaveFormat);
a=URL.createObjectURL(a);m.src=a})};d.hasCompressed||1!=g.a||0!=g.b||0!=g.c||1!=g.d||0!=g.e||0!=g.f?(b(d).hide(),S(!0,!0,f)):f()}else a()},F=!1;a.saveEdit=function(c){return new Promise(function(d,l){if(!u||F)return l(Error("`saveEdit(isCover)`: The function is invalid in current mode."));R="";F=!0;f();setTimeout(function(){I(function(){P();C();F=!1;y=v=null;try{(function(){for(var g=0;g<Q.thumbnailBoxArr.length;++g){var d=Q.thumbnailBoxArr[g],k=e[w];a._noAnyUseButForIosSafariBug0=k.naturalWidth;
a._noAnyUseButForIosSafariBug1=k.naturalHeight;var f=Math.min(d.kPainterMaxWH/k.naturalWidth,d.kPainterMaxWH/k.naturalHeight,1),m;c?(m=b(d.kPainterThumbBoxArr[w]),m=m.hasClass("kPainterThumbnailCanvas")?m[0]:m.find(".kPainterThumbnailCanvas")[0]):(m=document.createElement("canvas"),m.className="kPainterThumbnailCanvas");m.width=Math.round(k.naturalWidth*f);m.height=Math.round(k.naturalHeight*f);m.getContext("2d").drawImage(k,0,0,m.width,m.height);if(!c){k=d.kPainterFunWrap;f=null;try{f=k?k(m):m}catch(J){return setTimeout(function(){throw J;
},0),!1}f&&(f.getKPainterIndex=function(){return d.kPainterThumbBoxArr.indexOf(this)},d.kPainterThumbBoxArr.splice(w,0,f),b(d.kPainterThumbBoxArr[w-1]).after(f))}}})()}catch(g){setTimeout(function(){throw g;},0)}R="view";return d()},c)},100)})};a.rotateRight=function(){if(!u)return!1;var a=b(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,1,-1,0,0,0),a);b(d).setTransform(a);D({transform:a});a=d.fullQualityWidth;d.fullQualityWidth=d.fullQualityHeight;d.fullQualityHeight=a;X.setImgStyleFit();
return!0};a.rotateLeft=function(){if(!u)return!1;var a=b(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,-1,1,0,0,0),a);b(d).setTransform(a);D({transform:a});a=d.fullQualityWidth;d.fullQualityWidth=d.fullQualityHeight;d.fullQualityHeight=a;X.setImgStyleFit();return!0};a.mirror=function(){if(!u)return!1;var a=b(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(-1,0,0,1,0,0),a);b(d).setTransform(a);D({transform:a});X.setImgStyleFit();return!0};a.flip=function(){if(!u)return!1;var a=b(d).getTransform(),
a=kUtil.Matrix.dot(new kUtil.Matrix(1,0,0,-1,0,0),a);b(d).setTransform(a);D({transform:a});X.setImgStyleFit();return!0};a.resize=function(a,b){return new Promise(function(e,g){if(!u)return g(Error("`resize`: The function is invaild in this mode."));a=parseInt(a);b=parseInt(b);if(a!==a||1>a)return g(Error("`resize`: The parameter `newWidth` is invaild."));if(b!==b||1>b)return g(Error("`resize`: The parameter `newHeight` is invaild."));f();c.updateCvsAsync(!0,!0,function(){c.needAlwaysTrueTransform=
!0;for(var g=a,k=b;2*g<d.width;)g*=2;for(;2*k<d.height;)k*=2;for(var f=d,m;;){m=document.createElement("canvas");m.width=g;m.height=k;m.getContext("2d").drawImage(f,0,0,g,k);var l=!1;a!=g&&(g/=2,l=!0);b!=k&&(k/=2,l=!0);if(!l)break}h(m).then(function(a){c.pushStack({srcBlob:a,saveFormat:"image/jpeg"});c.updateCvs(!1,!1,function(){c.needAlwaysTrueTransform=!1;C();return e()})})})})};a.getEditWidth=function(){return u?d.fullQualityWidth:NaN};a.getEditHeight=function(){return u?d.fullQualityHeight:NaN}},
E=new function(){var c=this;a.isAutoShowCropUI=!0;var e=q.children(".kPainterCroper");c.isCropRectShowing=!1;a.showCropRect=c.showCropRect=function(){u&&(c.isCropRectShowing=!0,M(),e.show())};a.hideCropRect=c.hideCropRect=function(){c.isCropRectShowing=!1;e.hide()};e.css({"border-left-width":"100000px","border-top-width":"100000px","border-right-width":"100000px","border-bottom-width":"100000px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"});a.setCropRectStyle=function(a){switch(parseInt(a)){case 0:return e.find(">.kPainterBigMover").hide(),
e.find(">.kPainterMover").show(),!0;case 1:return e.find(">.kPainterMover").hide(),e.find(">.kPainterBigMover").show(),!0;default:return!1}};var f,h,w,x,C,H,E,S,N,P,I,F,B,p,l,g,n,k,t,m;a.cropRectMinW=50;a.cropRectMinH=50;var J=function(){"crop"==y&&(y=v=null)},L=function(){H=q.contentBoxRect();var a=b(d).getTransform(),c=parseFloat(d.style.left)+1E5,f=parseFloat(d.style.top)+1E5;0!=a.a*a.d&&0==a.b*a.c?(I=parseFloat(d.style.width),F=parseFloat(d.style.height)):(I=parseFloat(d.style.height),F=parseFloat(d.style.width));
var a=I/2,L=F/2;E=c-a;S=f-L;N=c+a;P=f+L;l=parseFloat(e[0].style.width);g=parseFloat(e[0].style.height);B=parseFloat(e[0].style.left)-l/2+1E5;p=parseFloat(e[0].style.top)-g/2+1E5;n=Math.max(-H.width/2,E);k=Math.max(-H.height/2,S);t=Math.min(H.width/2,N);m=Math.min(H.height/2,P)};q.find("> .kPainterCroper > .kPainterEdges > div, > .kPainterCroper > .kPainterCorners > div, > .kPainterCroper > .kPainterMover, > .kPainterCroper > .kPainterBigMover").on("touchstart touchcancel touchend mousedown",function(a){a.preventDefault();
var c=a.originalEvent.targetTouches;if(!c){if(!v)v="mouse";else if("mouse"!=v)return;c=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(c.length)if(!v)v="touch";else if("touch"!=v)return;1==c.length?null==y&&(y="crop",w=c[0].identifier,f=c[0].pageX,h=c[0].pageY,a=b(this).attr("data-orient").split(","),x=a[0],C=a[1],L()):0==c.length&&J()});q.on("mouseup",function(){"mouse"==v&&J()});q.on("mouseleave",function(a){"mouse"==v&&a.originalEvent.buttons&&J()});a.onCropRectChange=null;
var aa=function(){e[0].style.left=B+l/2-1E5+"px";e[0].style.right=-B-l/2-1E5+"px";e[0].style.top=p+g/2-1E5+"px";e[0].style.bottom=-p-g/2-1E5+"px";e[0].style.width=l+"px";e[0].style.height=g+"px";D(a.onCropRectChange)};q.on("touchmove mousemove",function(b){b.preventDefault();var c=b.originalEvent.targetTouches;if(!c){if("mouse"!=v)return;c=[{pageX:b.originalEvent.clientX,pageY:b.originalEvent.clientY}]}else if("touch"!=v)return;if(1==c.length&&"crop"==y&&w==c[0].identifier){var d=f;b=h;f=c[0].pageX;
h=c[0].pageY;c=f-d;b=h-b;-1==x?(l-c<a.cropRectMinW&&(c=l-a.cropRectMinW),B+c<n&&(c=n-B),l-=c,B+=c):1==x&&(l+c<a.cropRectMinW&&(c=-l+a.cropRectMinW),B+l+c>t&&(c=t-l-B),l+=c);-1==C?(g-b<a.cropRectMinH&&(b=g-a.cropRectMinH),p+b<k&&(b=k-p),g-=b,p+=b):1==C&&(g+b<a.cropRectMinH&&(b=-g+a.cropRectMinH),p+g+b>m&&(b=m-g-p),g+=b);0==x&&0==C&&(B+c<n?c=n-B:B+l+c>t&&(c=t-l-B),p+b<k?b=k-p:p+g+b>m&&(b=m-g-p),B+=c,p+=b);aa()}});var M=a.setCropRectArea=function(a,b,d,e){if(!c.isCropRectShowing)return!1;-.5<=a||(a=
-.5);-.5<=b||(b=-.5);.5>=d||(d=.5);.5>=e||(e=.5);a>d&&(a=d=(a+d)/2);b>e&&(b=e=(b+e)/2);L();B=E+(a+.5)*I;B<n&&(B=n);p=S+(b+.5)*F;p<k&&(p=k);a=E+(d+.5)*I;a>t&&(a=t);l=a-B;e=S+(e+.5)*F;e>m&&(e=m);g=e-p;aa();return!0},Y=a.getCropRectArea=function(a){if(!c.isCropRectShowing)return null;var e=b(d).getTransform();(0!=e.a*e.d&&0==e.b*e.c?parseFloat(d.style.width):parseFloat(d.style.height))!=I&&L();var e=(B-E)/I-.5,n=(p-S)/F-.5,k=e+l/I,m=n+g/F;a&&(e=Math.round(e*d.fullQualityWidth*2)/2,n=Math.round(n*d.fullQualityHeight*
2)/2,k=Math.round(k*d.fullQualityWidth*2)/2,m=Math.round(m*d.fullQualityHeight*2)/2);return[e,n,k,m]};c.getNeededRect=function(){L();var a={};a.width=2*Math.max(-B,B+l);a.height=2*Math.max(-p,p+g);return a};a.crop=function(a){return new Promise(function(b,c){if(!u)return c(Error("crop([ltrb])`: The function is invalid in this mode."));L();a=a||Y();if(!a)return c(Error("crop([ltrb])`: No thing can be cropped."));var g=a[0],e=a[1],n=a[2],k=a[3];if(.5>(g+.5)*d.fullQualityWidth&&.5>=(.5-n)*d.fullQualityWidth&&
.5>(e+.5)*d.fullQualityHeight&&.5>=(.5-k)*d.fullQualityHeight)return b([g,e,n,k]);T.pushStack({crop:{left:g+.5,top:e+.5,width:n-g,height:k-e}});T.updateCvsAsync(T.needAlwaysTrueTransform,!1,function(){return b([g,e,n,k])})})}},ba=new function(){var c=this;(function(){var e=Math.PI/180,r=Math.PI/6,w=Math.PI/18,x=function(a){var c=d.width,g=d.height,e;c>g?c>a&&(e=a/c,c=a,g=Math.round(g*e)||1):g>a&&(e=a/g,g=a,c=Math.round(c*e)||1);a=b(d).getTransform();var m;0!=a.a*a.d&&0==a.b*a.c?(e=c,m=g):(e=g,m=c);
var f=document.createElement("canvas");f.width=e;f.height=m;f=f.getContext("2d");f.setTransform(a.a,a.b,a.c,a.d,e/2*(1-a.a-a.c),m/2*(1-a.b-a.d));f.drawImage(d,0,0,c,g);return f.getImageData(0,0,e,m)},G=function(b,c,d){if("string"==typeof b||b instanceof String||b instanceof Blob)Q.getBlobAndFormatFromAnyImgData(b,function(a){a?U(a).then(function(a){G(a,c,d)}):d(null)});else if(b instanceof Image)try{a._noUseButTestSrc=b.src}catch(M){setTimeout(function(a){throw a;},0);d(null);return}else if(b instanceof
ImageData){if(b.width<=c&&b.height<=c){setTimeout(function(){d(b)},0);return}var g=b;b=document.createElement("canvas");b.width=g.width;b.height=g.height;b.getContext("2d").putImageData(g,b.width,b.height)}var e=document.createElement("canvas"),g=b.naturalWidth||b.videoWidth||b.width,f=b.naturalHeight||b.videoHeight||b.height,n=1;g>f?g>c&&(n=c/g,g=c,f=Math.round(f*n)||1):f>c&&(n=c/f,f=c,g=Math.round(g*n)||1);e.width=g;e.height=f;var k=e.getContext("2d");k.drawImage(b,0,0,e.width,e.height);setTimeout(function(){d(k.getImageData(0,
0,e.width,e.height))},0)};a.documentDetect=function(a){return new Promise(function(b,c){if(!a){if("perspect"!=y)return c(Error("`documentDetect`: The function is only valid in `freeTransform` mode."));f()}var d=KPainter._cv;G(a||x(256),256,function(c){var g=new d.matFromArray(c,d.CV_8UC4);c=g.cols;var f=g.rows,n=Math.min(g.cols,g.rows);d.cvtColor(g,g,d.ColorConversionCodes.COLOR_RGBA2GRAY.value,0);var k=new d.Mat;d.GaussianBlur(g,k,[5,5],0,0,d.BORDER_DEFAULT);d.delMat(g);g=new d.Mat;d.Canny(k,g,8,
.5*n,3,!1);d.delMat(k);var m=new d.Mat;d.HoughLinesP(g,m,1,e,8,8,3);d.delMat(g);for(var l=m.data32s(),h=[],g=c/2,t=f/2,k=0;k<l.length;k+=2)h.push(l[k]-g),h.push(l[k+1]-t);d.delMat(m);for(var p=[],k=0;k<h.length;k+=4){var m=h[k+0],q=h[k+1],z=h[k+2],x=h[k+3],v=q-x,A=z-m,l=m*x-z*q;if(0!=l){var u=0>l?-1:1,y=Math.sqrt(v*v+A*A),v=v/y*u,A=A/y*u,l=l/y*u,u=Math.atan(v/A),y=Math.abs(u);y>r&&y<Math.PI/2-r||(0>A?0==v?(A=-1,u=0):u=-u:0<A?0>v?u=-Math.PI-u:0<v?u=Math.PI-u:(A=1,u=Math.PI):0<v?(v=1,u=Math.PI/2):(v=
-1,u=-Math.PI/2),m=Math.sqrt((z-m)*(z-m)+(x-q)*(x-q)),p.push([v,A,l,u,m]))}}k=[];h=[];K(p,k,2,w,.7*n);K(k,h,2,w,.7*n);n=[null,null,null,null];for(k=0;k<h.length;++k)p=h[k],u=p[3],q=u<3*-Math.PI/4?0:u<-Math.PI/4?1:u<Math.PI/4?2:u<3*Math.PI/4?3:0,n[q]?(m=n[q],u=m[2],v=m[4],l=p[2],m=p[4],l*m>u*v&&(n[q]=p)):n[q]=p;for(k=0;k<n.length;++k)p=n[k],null==p&&(p=[],n[k]=p,0==k?(p[2]=t,p[3]=Math.PI):1==k?(p[2]=g,p[3]=-Math.PI/2):2==k?(p[2]=t,p[3]=0):3==k&&(p[2]=g,p[3]=Math.PI/2)),p[0]=Math.sin(p[3]),p[1]=-Math.cos(p[3]);
g=[];for(k=0;k<n.length;++k)h=n[k],m=n[(k-1+n.length)%n.length],t=h[0],l=h[1],h=h[2],p=m[0],q=m[1],u=m[2],m=(l*u-q*h)/(q*t-l*p),q=(t*u-p*h)/(p*l-t*q),g.push([m/c,q/f]);a||(S(g),C());b(g)})})};var K=function(a,b,c,d,e){for(var g=0;g<a.length;++g){for(var k=a[g],f=!1,n=0;n<b.length;++n){var m=b[n],l=m[3],h=k[3],p=l-h;p>Math.PI?h+=2*Math.PI:p<-Math.PI&&(h-=2*Math.PI);p=Math.abs(m[2]-k[2]);if(Math.abs(l-h)<d&&p<c){var f=!0,p=m[4],t=k[4],n=p+t;m[2]=(m[2]*p+k[2]*t)/n;l=(l*p+h*t)/n;l>Math.PI?l-=2*Math.PI:
l<=-Math.PI&&(l+=2*Math.PI);m[3]=l;m[4]=Math.min(n,e);break}}f||b.push([null,null,k[2],k[3],k[4]])}},H=q.children(".kPainterPerspect");c.hideFreeTransformBorderDirectly=function(){H.hide()};var O=q.find("> .kPainterPerspect > .kPainterPerspectCvs")[0];a.onFreeTransformCornerPosChange=null;var S=a.setFreeTransformCornerPos=function(a){if("perspect"==y){var c=d.kPainterZoom,g=b(d).getTransform(),e=d.width*c,c=d.height*c;if(0==g.a*g.d||0!=g.b*g.c)g=e,e=c,c=g;for(var f=q.borderBoxRect(),g=f.width/2-5,
f=f.height/2-5,l=0;l<I.length;++l){var h=I[l],p=b(h).attr("data-index"),r=a[p],p=e*r[0],r=c*r[1];p<-g?p=-g:p>g&&(p=g);r<-f?r=-f:r>f&&(r=f);h.style.left=p+"px";h.style.right=-p+"px";h.style.top=r+"px";h.style.bottom=-r+"px"}P();H.show()}},N=a.getFreeTransformCornerPos=function(){var a=d.kPainterZoom,c=b(d).getTransform(),e=d.width*a,a=d.height*a;if(0==c.a*c.d||0!=c.b*c.c)c=e,e=a,a=c;for(var c=[],f=0;f<I.length;++f){var m=I[f];c.push([parseFloat(m.style.left)/e,parseFloat(m.style.top)/a])}return c},
P=function(){var b=q.borderBoxRect();O.width=Math.round(b.width);O.height=Math.round(b.height);for(var c=[],d=0;d<I.length;++d)c.push([Math.round(parseFloat(I[d].style.left)+b.width/2),Math.round(parseFloat(I[d].style.top)+b.height/2)]);for(var b=O.getContext("2d"),e=Number.POSITIVE_INFINITY,f,d=0;4>d;++d){var l=c[d][0]*c[d][0]+c[d][1]*c[d][1];l<e&&(e=l,f=d)}for(var h=[],d=0;4>d;++d)h.push([c[(f+d)%4][0],c[(f+d)%4][1]]);b.fillStyle="rgba(0,0,0,0.3)";b.beginPath();b.moveTo(0,0);b.lineTo(h[0][0],h[0][1]);
f=function(a,b,c,d,g,e,f,h){return[Math.sign((d-b)*g+(a-c)*e+c*b-a*d),Math.sign((d-b)*f+(a-c)*h+c*b-a*d)]};c=[];for(d=0;4>d;++d)c.push(f(h[d][0],h[d][1],h[(d+1)%4][0],h[(d+1)%4][1],h[(d+2)%4][0],h[(d+2)%4][1],h[(d+3)%4][0],h[(d+3)%4][1]));d=function(a,b,c,d,g,e,f,h){var k=d-b,n=a-c;a=c*b-a*d;b=h-e;c=g-f;g=f*e-g*h;e=n*b-c*k;return[(a*c-g*n)/e,(g*k-a*b)/e]};f=void 0;e=function(){var a,b,c=h[1][0]-h[0][0];c&&(a=(h[1][1]-h[0][1])/c);var d=h[3][0]-h[0][0];d&&(b=(h[3][1]-h[0][1])/d);return 0<c?0<d?a<=b:
!0:0==c?0<d?!1:!0:0<=d?!1:a<=b}();0>c[0][0]*c[0][1]?0>c[2][0]*c[2][1]&&(f=d(h[0][0],h[0][1],h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1]),e?(b.lineTo(f[0],f[1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(h[1][0],h[1][1]),b.lineTo(f[0],f[1]),b.lineTo(h[3][0],h[3][1])):(b.lineTo(h[3][0],h[3][1]),b.lineTo(f[0],f[1]),b.lineTo(h[1][0],h[1][1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(f[0],f[1]))):0>c[1][0]*c[1][1]&&0>c[3][0]*c[3][1]&&(f=d(h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1],h[0][0],h[0][1]),e?(b.lineTo(h[1][0],
h[1][1]),b.lineTo(f[0],f[1]),b.lineTo(h[3][0],h[3][1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(f[0],f[1])):(b.lineTo(f[0],f[1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(h[3][0],h[3][1]),b.lineTo(f[0],f[1]),b.lineTo(h[1][0],h[1][1])));f||(e?(b.lineTo(h[1][0],h[1][1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(h[3][0],h[3][1])):(b.lineTo(h[3][0],h[3][1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(h[1][0],h[1][1])));b.lineTo(h[0][0],h[0][1]);b.lineTo(0,0);b.lineTo(0,O.height);b.lineTo(O.width,O.height);b.lineTo(O.width,0);b.lineTo(0,
0);b.fill();D(a.onFreeTransformCornerPosChange)},I=q.find("> .kPainterPerspect > .kPainterPerspectCorner");I.css("left","0");I.css("top","0");I.css("right","0");I.css("bottom","0");var F=null,B,p,l;I.on("touchstart touchcancel touchend mousedown",function(a){l=this;a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if(!v)v="mouse";else if("mouse"!=v)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(b.length)if(!v)v="touch";else if("touch"!=v)return;a=function(){var a=
H.width()/2-5,b=H.height()/2-5,c=parseFloat(l.style.left),d=parseFloat(l.style.top),g=!0,e=!0;c<-a?c=-a:c>a?c=a:g=!1;d<-b?d=-b:d>b?d=b:e=!1;g&&(l.style.left=c+"px",l.style.right=-c+"px");e&&(l.style.top=d+"px",l.style.bottom=-d+"px");(g||e)&&P()};1==b.length?("perspect"==y&&(y="perspectCornerMoving"),a(),F=b[0].identifier,B=b[0].pageX,p=b[0].pageY):0==b.length&&"perspectCornerMoving"==y&&(a(),v=null,y="perspect")});q.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;
if(!b){if("mouse"!=v)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=v)return;if(1==b.length&&"perspectCornerMoving"==y&&F==b[0].identifier){var c=B;a=p;B=b[0].pageX;p=b[0].pageY;b=B-c;a=p-a;b=parseFloat(l.style.left)+b;a=parseFloat(l.style.top)+a;l.style.left=b+"px";l.style.right=-b+"px";l.style.top=a+"px";l.style.bottom=-a+"px";P()}});q.on("mouseup",function(){"mouse"==v&&"perspectCornerMoving"==y&&(v=null,y="perspect")});q.on("mouseleave",function(a){"mouse"==
v&&a.originalEvent.buttons&&"perspectCornerMoving"==y&&(v=null,y="perspect")});a.freeTransformMaxWH=2048;a.freeTransform=function(b,c,e){return new Promise(function(b,g){if(!e&&"perspect"!=y)return g(Error("`freeTransform`: The function is only valid in `freeTransform` mode."));f();var k=KPainter._cv,l=c=c||N();.005>Math.abs(l[0][0]-.5)&&.005>Math.abs(l[0][1]-.5)&&.005>Math.abs(l[1][0]+.5)&&.005>Math.abs(l[1][1]-.5)&&.005>Math.abs(l[2][0]+.5)&&.005>Math.abs(l[2][1]+.5)&&.005>Math.abs(l[3][0]-.5)&&
.005>Math.abs(l[3][1]+.5)?(C(),e?b(null):b()):G(e||x(a.freeTransformMaxWH),a.freeTransformMaxWH,function(a){a=new k.matFromArray(a,k.CV_8UC4);k.cvtColor(a,a,k.ColorConversionCodes.COLOR_RGBA2RGB.value,0);for(var g=new k.Mat.zeros(4,1,k.CV_32FC2),f=g.data32f(),l=0;l<c.length;++l){var m=c[l];f[2*l]=Math.round((m[0]+.5)*a.cols);f[2*l+1]=Math.round((m[1]+.5)*a.rows)}var n=f[2]-f[0],p=f[3]-f[1],m=f[4]-f[2],l=f[5]-f[3],t=f[6]-f[4],r=f[7]-f[5],q=f[0]-f[6],u=f[1]-f[7],f=Math.round(Math.max(Math.sqrt(n*n+
p*p),Math.sqrt(t*t+r*r))),m=Math.round(Math.max(Math.sqrt(m*m+l*l),Math.sqrt(q*q+u*u))),q=new k.Mat.zeros(4,1,k.CV_32FC2),l=q.data32f();l[2]=f;l[4]=f;l[5]=m;l[7]=m;l=k.getPerspectiveTransform(g,q);k.delMat(g);k.delMat(q);g=new k.Mat.zeros(m,f,k.CV_8UC3);q=new k.Scalar(0,255,0);k.warpPerspective(a,g,l,[g.rows,g.cols],k.InterpolationFlags.INTER_LINEAR.value,k.BORDER_CONSTANT,q);k.delMat(a);k.delMat(l);k.delMat(q);a=new ImageData(f,m);q=g.channels();n=g.data();for(p=l=0;l<n.length;l+=q,p+=4)a.data[p]=
n[l],a.data[p+1]=n[l+1%q],a.data[p+2]=n[l+2%q],a.data[p+3]=255;k.delMat(g);d.width=f;d.height=m;d.getContext("2d").putImageData(a,0,0);X.setImgStyleFit();h(d,"image/jpeg").then(function(a){e?b(a):(T.pushStack({srcBlob:a,saveFormat:"image/jpeg"}),T.updateCvsAsync(!0,!1,function(){S([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);y="perspect";C();b()}))})})})};a.enterFreeTransformMode=function(){return new Promise(function(a,b){if(!u)return b(Error("`enterFreeTransformMode`: The function is only valid in edit mode."));
if(!KPainter.cvHasLoaded)return b(Error("`enterFreeTransformMode`: You should call `KPainter.loadCvScript()` first before use this function."));R="";v=null;y="perspect";f();setTimeout(function(){E.hideCropRect();T.updateCvsAsync(!0,!1,function(){S([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);H.show();C();T.needAlwaysTrueTransform=!0;R="freeTransform";a()})},0)})};a.exitFreeTransformMode=function(){return new Promise(function(b,c){if("perspect"!=y)return c(Error("`exitFreeTransformMode`: It is not in `freeTransform` mode."));
R="";H.hide();T.updateCvsAsync(!1,!1,function(){a.isAutoShowCropUI&&E.showCropRect();y=v=null;T.needAlwaysTrueTransform=!1;R="basicEdit";b()})})}})()};new function(){a.videoHtmlElement=b('<div class="kPainterVideoMdl" style="display:none;"><video class="kPainterVideo" webkit-playsinline="true"></video><select class="kPainterCameraSelect"></select><select class="kPainterResolutionSelect"><option class="kPainterGotResolutionOpt" value="got" selected></option><option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option></select><button class="kPainterBtnGrabVideo"><svg width="48" viewBox="0 0 2048 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z"/></svg></button><button class="kPainterBtnCloseVideo"><svg width="48" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button></div>')[0];
a.videoSettings={video:{facingMode:{ideal:"environment"}}};a.beforeAddImgFromGrabVideoBtn=null;a.afterAddImgFromGrabVideoBtn=null;a.grabVideo=null;a.hideVideo=null;a.showVideo=function(c){a.hideVideo&&a.hideVideo();var d=b(a.videoHtmlElement).find(".kPainterVideo")[0],e=b(a.videoHtmlElement).find(".kPainterCameraSelect")[0],f=b(a.videoHtmlElement).find(".kPainterResolutionSelect")[0],h=b(a.videoHtmlElement).find(".kPainterGotResolutionOpt")[0],q=b(a.videoHtmlElement).find(".kPainterBtnGrabVideo")[0],
u=b(a.videoHtmlElement).find(".kPainterBtnCloseVideo")[0],w=function(){return e?navigator.mediaDevices.enumerateDevices().then(function(a){var b=e.value;e.innerHTML="";for(var c=void 0,f=0;f<a.length;++f){var h=a[f];if("videoinput"==h.kind){var p=document.createElement("option");p.value=h.deviceId;p.innerText=h.label||"camera "+f;e.appendChild(p);b==h.deviceId&&(c=p)}}var m=e.childNodes;if(!c&&m.length)try{d.srcObject.getTracks().forEach(function(a){if("video"==a.kind)for(var b=0;b<m.length;++b){var d=
m[b];if(a.label==d.innerText)throw c=d,"found the using source";}})}catch(J){self.kConsoleLog&&self.kConsoleLog(J)}c&&(e.value=c.value)}):Promise.reject("no camera select")},v=function(){d.srcObject&&(self.kConsoleLog&&self.kConsoleLog("======stop video========"),d.srcObject.getTracks().forEach(function(a){a.stop()}))},x=function(p){return new Promise(function(l,g){v();self.kConsoleLog&&self.kConsoleLog("======before video========");var n=c?c:a.videoSettings,k=f?b(f).children(":selected")[0]:null;
if(k&&k.hasAttribute("data-width")){var q=k.getAttribute("data-width"),k=k.getAttribute("data-height");h.setAttribute("data-width",q);h.setAttribute("data-height",k);/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?1280<=q?n.video.width=1280:640<=q?n.video.width=640:320<=q&&(n.video.width=320):(n.video.width={ideal:q},n.video.height={ideal:k});!p&&(q=b(e).children(":selected")[0])&&(p=q.value);p&&(n.video.facingMode=void 0,n.video.deviceId=
{exact:p})}var m=!1,r=function(){self.kConsoleLog&&self.kConsoleLog("======try getUserMedia========");self.kConsoleLog&&self.kConsoleLog("ask "+JSON.stringify(n.video.width)+"x"+JSON.stringify(n.video.height));navigator.mediaDevices.getUserMedia(n).then(function(a){self.kConsoleLog&&self.kConsoleLog("======get video========");return new Promise(function(b,c){d.srcObject=a;d.onloadedmetadata=function(){self.kConsoleLog&&self.kConsoleLog("======play video========");d.play().then(function(){self.kConsoleLog&&
self.kConsoleLog("======played video========");var a=d.videoWidth+"x"+d.videoHeight;h&&(h.innerText=a);f&&(f.value="got");self.kConsoleLog&&self.kConsoleLog(a);b()},function(a){c(a)})};d.onerror=function(){c()}})}).then(function(){l()})["catch"](function(a){self.kConsoleLog&&self.kConsoleLog(a);m?g(a):(m=!0,n.video.width=void 0,n.video.height=void 0,r())})};r()})},y=function(){x(e.value).then(function(){F&&v()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};e&&e.addEventListener("change",
y);var C=function(){x().then(function(){F&&v()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};f&&f.addEventListener("change",C);a.grabVideo=function(b){var c=document.createElement("canvas");c.width=d.videoWidth;c.height=d.videoHeight;c.getContext("2d").drawImage(d,0,0);return b?a.addImage(c):c};var E=function(){if(a.beforeAddImgFromGrabVideoBtn){var b=a.grabVideo();D(a.beforeAddImgFromGrabVideoBtn,[b,function(b){a.addImage(b).then(function(b){D(a.afterAddImgFromGrabVideoBtn,
[!0,b])},function(b){D(a.afterAddImgFromGrabVideoBtn,[!1,b])})}])}else a.grabVideo(!0).then(function(b){D(a.afterAddImgFromGrabVideoBtn,[!0,b])},function(b){D(a.afterAddImgFromGrabVideoBtn,[!1,b])});a.hideVideo()};if(q)b(q).on("click",E);var F=!1,B=function(){v();F=!0;h.removeAttribute("data-width");var c=a.videoHtmlElement.parentNode;c&&c.removeChild(a.videoHtmlElement);e&&e.removeEventListener("change",y);f&&f.removeEventListener("change",C);q&&b(q).off("click",E);u&&b(u).off("click",B);a.grabVideo=
null;a.hideVideo=null};a.hideVideo=B;if(u)b(u).on("click",B);document.body.appendChild(a.videoHtmlElement);return x().then(function(){if(F)return v(),Promise.reject("Video window has closed.");w()["catch"](function(a){self.kConsoleLog&&kConsoleLog(a)});b(a.videoHtmlElement).show();return Promise.resolve()})}}};KPainter.cvFolder=void 0==KPainter.cvFolder?"js":KPainter.cvFolder;KPainter.cvHasLoaded=!1;
KPainter._doCallbackNoBreak=function(c,a){if(c)try{c.apply(window,a||[])}catch(b){setTimeout(function(){throw b;},0)}};
KPainter.loadCvScript=function(){return new Promise(function(c,a){KPainter._loadCvQueue=KPainter._loadCvQueue||new TaskQueue;KPainter._loadCvQueue.push(function(){if(KPainter.cvHasLoaded)c(),KPainter._loadCvQueue.next();else{KPainter._CVModule={cvFolder:KPainter.cvFolder,preRun:[],postRun:[],isRuntimeInitialized:!1,onRuntimeInitialized:function(){KPainter.cvHasLoaded=!0;self.kConsoleLog&&kConsoleLog("Runtime is ready!");c();KPainter._loadCvQueue.next()},onExit:function(){a(Error("load wasm failed."));
KPainter._loadCvQueue.next()},onAbort:function(){a(Error("load wasm failed."));KPainter._loadCvQueue.next()},print:function(a){self.kConsoleLog&&kConsoleLog(a)},printErr:function(a){self.kConsoleLog&&kConsoleLog(a)},setStatus:function(a){self.kConsoleLog&&kConsoleLog(a)},totalDependencies:0};KPainter._CVModule.setStatus("Downloading...");var b=document.createElement("script"),h=KPainter.cvFolder;"/"!=h.charAt(h.length-1)&&(h+="/");b.src=window.WebAssembly?h+"cv-wasm.js?v=20180921":h+"cv.js?v=201800921";
b.onerror=function(){a(Error("load script failed."));KPainter._loadCvQueue.next()};document.body.appendChild(b)}})})};var MBC=KPainter;
