/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Mobile Browser Capture
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2018, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 2.1.3
 * @fileoverview Dynamsoft JavaScript Library for Basic Image Edit
 * More info on MBC: http://www.dynamsoft.com/
 */
var $jscomp={scope:{},findInternal:function(c,a,b){c instanceof String&&(c=String(c));for(var k=c.length,v=0;v<k;v++){var U=c[v];if(a.call(b,U,v,c))return{i:v,v:U}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,a,b,k){if(a){b=$jscomp.global;c=c.split(".");for(k=0;k<c.length-1;k++){var v=c[k];v in b||(b[v]={});b=b[v]}c=c[c.length-1];k=b[c];a=a(k);a!=k&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");$jscomp.polyfill("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(a,b,c){var k=this.length||0;0>b&&(b=Math.max(0,k+b));if(null==c||c>k)c=k;c=Number(c);0>c&&(c=Math.max(0,k+c));for(b=Number(b||0);b<c;b++)this[b]=a;return this}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(c){var a=0;return $jscomp.iteratorPrototype(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})};$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var a=c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function a(){this.batch_=null}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var b=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){b(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(B){this.asyncThrow_(B)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var k=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(Y){b.reject(Y)}};k.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};k.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof k)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};k.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(Y){this.reject_(Y);return}"function"==
typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};k.prototype.reject_=function(a){this.settle_(2,a)};k.prototype.fulfill_=function(a){this.settle_(1,a)};k.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};k.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var v=new a;k.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};k.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(B){c.reject(B)}};k.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{w(a(b))}catch(x){d(x)}}:b}var w,d,y=new k(function(a,b){w=a;d=b});this.callWhenSettled_(c(a,w),
c(b,d));return y};k.prototype["catch"]=function(a){return this.then(void 0,a)};k.prototype.callWhenSettled_=function(a,b){function c(){switch(k.state_){case 1:a(k.result_);break;case 2:b(k.result_);break;default:throw Error("Unexpected state: "+k.state_);}}var k=this;null==this.onSettledCallbacks_?v.asyncExecute(c):this.onSettledCallbacks_.push(function(){v.asyncExecute(c)})};k.resolve=function(a){return a instanceof k?a:new k(function(b,c){b(a)})};k.reject=function(a){return new k(function(b,c){c(a)})};
k.race=function(a){return new k(function(b,c){for(var w=$jscomp.makeIterator(a),d=w.next();!d.done;d=w.next())k.resolve(d.value).callWhenSettled_(b,c)})};k.all=function(a){var b=$jscomp.makeIterator(a),c=b.next();return c.done?k.resolve([]):new k(function(a,d){function w(b){return function(c){h[b]=c;B--;0==B&&a(h)}}var h=[],B=0;do h.push(void 0),B++,k.resolve(c.value).callWhenSettled_(w(h.length-1),d),c=b.next();while(!c.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(k.$jscomp$new$AsyncExecutor=function(){return new a});
return k},"es6-impl","es3");var kUtil=kUtil||{};Math.sign||(Math.sign=function(c){return 0<c?1:0==c?0>1/c?-0:0:0>c?-1:NaN});kUtil.Matrix=function(c,a,b,k,v,U){this.a=c;this.b=a;this.c=b;this.d=k;this.e=v;this.f=U};kUtil.Matrix.dot=function(c,a){return new kUtil.Matrix(c.a*a.a+c.c*a.b,c.b*a.a+c.d*a.b,c.a*a.c+c.c*a.d,c.b*a.c+c.d*a.d,c.a*a.e+c.c*a.f+c.e,c.b*a.e+c.d*a.f+c.f)};kUtil.Matrix.prototype.dot=function(c){return kUtil.Matrix.dot(this,c)};
kUtil.Matrix.equals=function(c,a){return c.a==a.a&&c.b==a.b&&c.c==a.c&&c.d==a.d&&c.e==a.e&&c.f==a.f};kUtil.Matrix.prototype.equals=function(c){return kUtil.Matrix.equals(this,c)};kUtil.Matrix.prototype.inversion=function(){var c=this.a,a=this.b,b=this.c,k=this.d,v=this.e,U=this.f,w=c*k-a*b;return new kUtil.Matrix(k/w,-a/w,-b/w,c/w,(b*U-k*v)/w,(a*v-c*U)/w)};
kUtil.convertURLToBlob=function(c,a){var b=new XMLHttpRequest;b.open("GET",c,!0);b.responseType="blob";b.onloadend=function(){a(this.response)};b.send()};kUtil.convertBase64ToBlob=function(c,a){for(var b=atob(c),k=Array(b.length),v=0;v<b.length;++v)k[v]=b.charCodeAt(v);b=new Uint8Array(k);return new Blob([b],{type:a})};
Date.prototype.kUtilFormat=function(c){var a={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"h+":this.getUTCHours(),"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),S:this.getUTCMilliseconds()};/(y+)/.test(c)&&(c=c.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var b in a)(new RegExp("("+b+")")).test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?a[b]:("00"+a[b]).substr((""+a[b]).length)));return c};
kUtil.copyToClipBoard=function(c){if(navigator.clipboard)navigator.clipboard.writeText(c)["catch"](function(a){alert("copy failed, info: "+(a.message||a))});else{var a=document.createElement("textarea");a.style.width="4px";a.style.height="4px";a.style.position="fixed";a.style.left="0";a.style.top="0";jQuery(document.body).append(a);a.value=c;a.focus();a.select();try{document.execCommand("copy")||alert("copy failed")}catch(b){alert("copy failed, info: "+(b.message||b))}jQuery(a).remove()}};
(function(c){c.fn.borderWidth=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("border-left-width"):a.getAttribute("border-left-width"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("border-top-width"):a.getAttribute("border-top-width"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("border-right-width"):a.getAttribute("border-right-width"))||0;b.bottom=parseFloat(a.getPropertyValue?
a.getPropertyValue("border-bottom-width"):a.getAttribute("border-bottom-width"))||0;return b};c.fn.padding=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-left"):a.getAttribute("padding-left"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-top"):a.getAttribute("padding-top"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-right"):a.getAttribute("padding-right"))||
0;b.bottom=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-bottom"):a.getAttribute("padding-bottom"))||0;return b};c.fn.borderBoxRect=function(){var a=null;window.getComputedStyle&&(a=getComputedStyle(this[0]));var b=this.offset(),c={};c.pageX0=b.left;c.pageY0=b.top;c.width=a?parseFloat(a.width):this.outerWidth();c.height=a?parseFloat(a.height):this.outerHeight();c.pageX1=c.pageX0+c.width;c.pageY1=c.pageY0+c.height;return c};c.fn.paddingBoxRect=function(){var a=this.borderBoxRect(),b=this.borderWidth(),
c={};c.pageX0=a.pageX0+b.left;c.pageY0=a.pageY0+b.top;c.width=window.getComputedStyle?a.width-(b.left+b.right):this.innerWidth();c.height=window.getComputedStyle?a.height-(b.top+b.bottom):this.innerHeight();c.pageX1=a.pageX1-b.right;c.pageY1=a.pageY1-b.bottom;return c};c.fn.contentBoxRect=function(){var a=this.paddingBoxRect(),b=this.padding(),c={};c.pageX0=a.pageX0+b.left;c.pageY0=a.pageY0+b.top;c.width=window.getComputedStyle?a.width-(b.left+b.right):this.width();c.height=window.getComputedStyle?
a.height-(b.top+b.bottom):this.height();c.pageX1=a.pageX1-b.right;c.pageY1=a.pageY1-b.bottom;return c};c.fn.getTransform=function(){var a=this.css("transform");if("none"==a||""==a)a=this[0].style.transform;var b="matrix(",c=a.indexOf(b);if(-1!=c){c+=b.length;a=a.substring(c,a.indexOf(")",c)).split(",");for(b=0;b<a.length;++b)a[b]=parseFloat(a[b]);return new kUtil.Matrix(a[0],a[1],a[2],a[3],a[4],a[5])}b="scale(";c=a.indexOf(b);return-1!=c?(c+=b.length,a=parseFloat(a.substring(c)),new kUtil.Matrix(a,
0,0,a,0,0)):new kUtil.Matrix(1,0,0,1,0,0)};c.fn.setTransform=function(a){a="matrix("+[a.a,a.b,a.c,a.d,a.e,a.f].join()+")";this.css("transform",a)}})(jQuery);var TaskQueue=function(){this._queue=[];this.isWorking=!1;this.timeout=100};TaskQueue.prototype.push=function(c,a,b){this._queue.push({task:c,context:a,args:b});this.isWorking||this.next()};TaskQueue.prototype.unshift=function(c,a,b){this._queue.unshift({task:c,context:a,args:b});this.isWorking||this.next()};
TaskQueue.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var c=this._queue.shift(),a=c.task,b=c.context?c.context:self,k=c.args?c.args:[];setTimeout(function(){a.apply(b,k)},this.timeout)}};
(function(){function c(a,b){b||a.match(/^data\:([^\;]+)\;base64,/mi);a=a.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var c=atob(a),d=c.length,e=new ArrayBuffer(d),t=new Uint8Array(e),h=0;h<d;h++)t[h]=c.charCodeAt(h);return e}function a(a,c){var b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="blob";b.onload=function(a){200!=this.status&&0!==this.status||c(this.response)};b.send()}function b(b,d){function e(a){var c=k(a),r;a:if(r=new DataView(a),255!=r.getUint8(0)||216!=r.getUint8(1))r=!1;
else{for(var p=2,e=a.byteLength;p<e;){var t=r,h=p;if(56===t.getUint8(h)&&66===t.getUint8(h+1)&&73===t.getUint8(h+2)&&77===t.getUint8(h+3)&&4===t.getUint8(h+4)&&4===t.getUint8(h+5)){t=r.getUint8(p+7);0!==t%2&&(t+=1);0===t&&(t=4);var e=p+8+t,p=r.getUint16(p+6+t),F,P;r=e;e=new DataView(a);t={};for(h=r;h<r+p;)28===e.getUint8(h)&&2===e.getUint8(h+1)&&(F=e.getUint8(h+2),F in T&&(P=e.getInt16(h+3),F=T[F],P=w(e,h+5,P),t.hasOwnProperty(F)?t[F]instanceof Array?t[F].push(P):t[F]=[t[F],P]:t[F]=P)),h++;r=t;break a}p++}r=
void 0}var S;a:if("DOMParser"in self)if(p=new DataView(a),255!=p.getUint8(0)||216!=p.getUint8(1))S=!1;else{e=2;t=a.byteLength;for(a=new DOMParser;e<t-4;)if("http"==w(p,e,4)){t=e-1;e=p.getUint16(e-2)-1;p=w(p,t,e);e=p.indexOf("xmpmeta>")+8;p=p.substring(p.indexOf("<x:xmpmeta"),e);e=p.indexOf("x:xmpmeta")+10;p=p.slice(0,e)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
p.slice(e);b:{a=a.parseFromString(p,"text/xml");try{p={};if(0<a.children.length)for(e=0;e<a.children.length;e++){var y=a.children.item(e),B=y.attributes,x;for(x in B){var V=B[x],A=V.nodeName,C=V.nodeValue;void 0!==A&&(p[A]=C)}var l=y.nodeName;if("undefined"==typeof p[l])p[l]=xml2json(y);else{if("undefined"==typeof p[l].push){var u=p[l];p[l]=[];p[l].push(u)}p[l].push(xml2json(y))}}else p=a.textContent;S=p;break b}catch(g){console.log(g.message)}S=void 0}break a}else e++;S=void 0}else S=void 0;b.exifdata=
c||{};b.iptcdata=r||{};b.xmpdata=S||{};d&&d.call(b)}if(b.src)if(/^data\:/i.test(b.src)){var t=c(b.src);e(t)}else if(/^blob\:/i.test(b.src)){var h=new FileReader;h.onload=function(a){e(a.target.result)};a(b.src,function(a){h.readAsArrayBuffer(a)})}else{var F=new XMLHttpRequest;F.onload=function(){if(200==this.status||0===this.status)e(F.response);else throw"Could not load image";F=null};F.open("GET",b.src,!0);F.responseType="arraybuffer";F.send(null)}else self.FileReader&&(b instanceof self.Blob||
b instanceof self.File)&&(h=new FileReader,h.onload=function(a){e(a.target.result)},h.readAsArrayBuffer(b))}function k(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var c=2;a=a.byteLength;for(var e;c<a;){if(255!=b.getUint8(c))return!1;e=b.getUint8(c+1);if(225==e)return Y(b,c+4,b.getUint16(c+2)-2);c+=2+b.getUint16(c+2)}}function v(a,b,c,d,h){var e=a.getUint16(c,!h),t={},D,r,p;for(p=0;p<e;p++)D=c+12*p+2,r=d[a.getUint16(D,!h)],t[r]=U(a,D,b,c,h);return t}function U(a,b,c,
d,h){var e=a.getUint16(b+2,!h);d=a.getUint32(b+4,!h);c=a.getUint32(b+8,!h)+c;var t,D;switch(e){case 1:case 7:if(1==d)return a.getUint8(b+8,!h);c=4<d?c:b+8;b=[];for(e=0;e<d;e++)b[e]=a.getUint8(c+e);return b;case 2:return w(a,4<d?c:b+8,d-1);case 3:if(1==d)return a.getUint16(b+8,!h);c=2<d?c:b+8;b=[];for(e=0;e<d;e++)b[e]=a.getUint16(c+2*e,!h);return b;case 4:if(1==d)return a.getUint32(b+8,!h);b=[];for(e=0;e<d;e++)b[e]=a.getUint32(c+4*e,!h);return b;case 5:if(1==d)return t=a.getUint32(c,!h),D=a.getUint32(c+
4,!h),a=new Number(t/D),a.numerator=t,a.denominator=D,a;b=[];for(e=0;e<d;e++)t=a.getUint32(c+8*e,!h),D=a.getUint32(c+4+8*e,!h),b[e]=new Number(t/D),b[e].numerator=t,b[e].denominator=D;return b;case 9:if(1==d)return a.getInt32(b+8,!h);b=[];for(e=0;e<d;e++)b[e]=a.getInt32(c+4*e,!h);return b;case 10:if(1==d)return a.getInt32(c,!h)/a.getInt32(c+4,!h);b=[];for(e=0;e<d;e++)b[e]=a.getInt32(c+8*e,!h)/a.getInt32(c+4+8*e,!h);return b}}function w(a,b,c){for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a.getUint8(e));
return d}function Y(a,b){if("Exif"!=w(a,b,4))return!1;var c,d,e,t,k=b+6;if(18761==a.getUint16(k))c=!1;else if(19789==a.getUint16(k))c=!0;else return!1;if(42!=a.getUint16(k+2,!c))return!1;var D=a.getUint32(k+4,!c);if(8>D)return!1;d=v(a,k,k+D,h,c);if(d.ExifIFDPointer)for(e in t=v(a,k,k+d.ExifIFDPointer,y,c),t){switch(e){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":t[e]=
x[e][t[e]];break;case "ExifVersion":case "FlashpixVersion":t[e]=String.fromCharCode(t[e][0],t[e][1],t[e][2],t[e][3]);break;case "ComponentsConfiguration":t[e]=x.Components[t[e][0]]+x.Components[t[e][1]]+x.Components[t[e][2]]+x.Components[t[e][3]]}d[e]=t[e]}if(d.GPSInfoIFDPointer)for(e in t=v(a,k,k+d.GPSInfoIFDPointer,E,c),t){switch(e){case "GPSVersionID":t[e]=t[e][0]+"."+t[e][1]+"."+t[e][2]+"."+t[e][3]}d[e]=t[e]}D=k+D;e=a.getUint16(D,!c);if(D=a.getUint32(D+2+12*e,!c))if(D>a.byteLength)k={};else{D=
v(a,k,k+D,A,c);if(D.Compression)switch(D.Compression){case 6:D.JpegIFOffset&&D.JpegIFByteCount&&(D.blob=new Blob([new Uint8Array(a.buffer,k+D.JpegIFOffset,D.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",D.Compression)}else 2==D.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");k=D}else k={};d.thumbnail=k;return d}
var B=self,d=function(a){if(a instanceof d)return a;if(!(this instanceof d))return new d(a);this.EXIFwrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=d),exports.EXIF=d):B.EXIF=d;var y=d.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",
36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",
41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",
42016:"ImageUniqueID"},h=d.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",
301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},E=d.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",
16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},A=d.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",
278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},x=d.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",
2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",
24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",
32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",
95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},
GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},T={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",
105:"headline",116:"copyright",15:"category"};d.getData=function(a,c){if((self.Image&&a instanceof self.Image||self.HTMLImageElement&&a instanceof self.HTMLImageElement)&&!a.complete)return!1;a.exifdata?c&&c.call(a):b(a,c);return!0};d.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};d.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};d.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};d.getAllIptcTags=
function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};d.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};d.readFromBinaryFile=function(a){return k(a)};"function"===typeof define&&define.amd&&define("exif-js",
[],function(){return d})}).call(this);
var KPainter=function(c){var a=this;c=c||{};KPainter.xxx="mouse"==c.gesturer?!1:"touch"==c.gesturer?!0:"ontouchend"in document?!0:!1;var b=jQuery,k=function(a,b,c,d){a.toBlob?a.toBlob(b,c,d):(a=a.toDataURL(c,d),c=kUtil.convertBase64ToBlob(a.substring(a.indexOf(",")+1),c),b(c))},v=function(a,b,c){b=b||new kUtil.Matrix(1,0,0,1,0,0);var d=document.createElement("canvas"),h=!1;0!=b.a*b.d&&0==b.b*b.c?(d.width=a.naturalWidth||a.width,d.height=a.naturalHeight||a.height):(h=!0,d.width=a.naturalHeight||a.height,
d.height=a.naturalWidth||a.width);if(d.width>c||d.height>c)c/=Math.max(d.width,d.height),d.width=Math.min(d.width*c),d.height=Math.min(d.height*c);c=d.getContext("2d");c.setTransform(b.a,b.b,b.c,b.d,b.e*d.width,b.f*d.height);h?c.drawImage(a,0,0,d.height,d.width):c.drawImage(a,0,0,d.width,d.height);return d},U=function(a,b,c,d){var h=function(){var h=URL.createObjectURL(a),e=new Image;e.onload=e.onerror=function(){e.onload=e.onerror=null;var a=v(e,b,d);URL.revokeObjectURL(h);c(a)};e.src=h};window.createImageBitmap?
createImageBitmap(a).then(function(a){c(v(a,b,d))})["catch"](function(){h()}):h()},w=KPainter._doCallbackNoBreak,Y=b('<div style="width:800px;height:600px;border:1px solid #ccc;"><div class="kPainterBox"><div class="kPainterImgsDiv"><canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas></div><div class="kPainterCroper" style="width:50px;height:50px;display:none;"><div class="kPainterCells"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div><div class="kPainterEdges"><div data-orient="-1,0"></div><div data-orient="0,-1"></div><div data-orient="1,0"></div><div data-orient="0,1"></div></div><div class="kPainterCorners"><div data-orient="-1,-1"><i></i></div><div data-orient="1,-1"><i></i></div><div data-orient="1,1"><i></i></div><div data-orient="-1,1"><i></i></div></div><div class="kPainterMover" data-orient="0,0"><div></div><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg></div></div><div class="kPainterPerspect" style="display:none;"><canvas class="kPainterPerspectCvs"></canvas><div class="kPainterPerspectCorner" data-index="0">lt</div><div class="kPainterPerspectCorner" data-index="1">rt</div><div class="kPainterPerspectCorner" data-index="2">rb</div><div class="kPainterPerspectCorner" data-index="3">lb</div></div><div class="kPainterGesturePanel"></div></div></div>')[0],
B=b(Y).children(),d=B.find("> .kPainterImgsDiv > .kPainterCanvas")[0];a.getHtmlElement=function(){return Y};var y=-1,h=[],E=null,A=null,x=!1,T="view";a.getCurIndex=function(){return y};a.getCount=function(){return h.length};a.isEditing=function(){return x};a.getMode=function(){return T};a.getImage=function(a,c){void 0==c&&(c=y);if(!(isNaN(c)||(c=Math.round(c),0>c||c>=h.length))){var d;a?d=h[c]:(d=b(h[c]).clone()[0],d.setAttribute("style",""));return d}};a.onStartLoading=null;a.onFinishLoading=null;
var e=function(){w(a.onStartLoading)},t=function(){w(a.onFinishLoading)},S=new function(){a.defaultFileInput=b('<input type="file" accept="image/bmp,image/gif,image/jpeg,image/png,image/webp" multiple style="display:none">')[0];a.beforeAddImgFromFileChooseWindow=null;a.afterAddImgFromFileChooseWindow=null;b(a.defaultFileInput).change(function(b){var c=this;b=b.originalEvent;a.beforeAddImgFromFileChooseWindow?w(a.beforeAddImgFromFileChooseWindow,[b,function(b){d(b,function(b){w(a.afterAddImgFromFileChooseWindow,
[b]);c.value=""})}]):d(c.files,function(b){w(a.afterAddImgFromFileChooseWindow,[b]);c.value=""})});a.showFileChooseWindow=function(){if(x)return!1;a.defaultFileInput.click();return!0};a.beforeAddImgFromDropFile=null;a.afterAddImgFromDropFile=null;B.on("dragover",function(a){a=a.originalEvent;a.stopPropagation();a.preventDefault()});B.on("drop",function(b){b=b.originalEvent;b.stopPropagation();b.preventDefault();a.beforeAddImgFromDropFile?w(a.beforeAddImgFromDropFile,[b,function(b){d(b,a.afterAddImgFromDropFile)}]):
d(b.dataTransfer.files,a.afterAddImgFromDropFile)});var c=new TaskQueue,d=a.addImageAsync=function(a,b){if(x)w(b,[!1]);else if(a)if(a instanceof Blob||a instanceof HTMLCanvasElement||"string"==typeof a||a instanceof String||a instanceof HTMLImageElement)e(),c.push(E,null,[a,function(a){w(b,[a]);c.next();c.isWorking||t()}]);else if(a instanceof Array||a instanceof FileList)for(var g=[],l=!1,n=0;n<a.length;++n)d(a[n],function(c){g.push(c);l=l||c;g.length==a.length&&w(b,[l,g])});else w(b,[!1]);else w(b,
[!1])},p=function(a,b){"image/jpeg"!=a.type?b(null):EXIF.getData(a,function(){var a=null;switch(EXIF.getTag(this,"Orientation")){case 6:a=new kUtil.Matrix(0,1,-1,0,1,0);break;case 3:a=new kUtil.Matrix(-1,0,0,-1,1,1);break;case 8:a=new kUtil.Matrix(0,-1,1,0,0,1)}b(a)})},ca=function(a,b){var c=a.slice(25,26),l=new FileReader;l.onload=function(){var a=(new Int8Array(l.result))[0];b(4==(a&4))};l.readAsArrayBuffer(c)},A=function(a,b){var c=a.type;-1!=c.indexOf("webp")?b&&b("image/webp"):-1!=c.indexOf("gif")||
-1!=c.indexOf("svg")?b&&b("image/png"):-1!=c.indexOf("png")?ca(a,function(a){b&&b(a?"image/png":"image/jpeg")}):b&&b("image/jpeg")},E=function(a,b){J(a,function(a,c){a?w(function(){N(a,c,b)}):b(!1)})},J=this.getBlobAndFormatFromAnyImgData=function(a,b){var c=function(a){A(a,function(c){p(a,function(g){H(a,g,c,function(a){b(a,c)})})})};if(a instanceof Blob)c(a);else if(a instanceof HTMLCanvasElement)k(a,function(a){c(a)});else if("string"==typeof a||a instanceof String)if("data:"==a.substring(0,5)){var f=
"";"image/"==a.substring(5,11)&&(f=a.substring(5,a.indexOf(";",11)));f=kUtil.convertBase64ToBlob(a.substring(a.indexOf("base64,")+7),f);c(f)}else kUtil.convertURLToBlob(a,function(a){a?c(a):b(null,"")});else if(a instanceof HTMLImageElement){var l;try{l=a.src}catch(m){setTimeout(function(){throw m;},0);b(null,"");return}J(l,function(g,f){if(g)b(g,f);else{var d=document.createElement("canvas");d.width=a.naturalWidth;d.height=a.naturalHeight;d.getContext("2d").drawImage(a,0,0);var q="",m=l.lastIndexOf("?"),
n=-1;-1!=m?(n=l.lastIndexOf(".",m),-1!=n&&5>=m-n&&(q=l.substring(n+1,m))):(n=l.lastIndexOf("."),-1!=n&&(q=5>=l.length-n?l.substring(n+1):l.substring(n+1,n+5)));q=-1!=q.indexOf("webp")?"image/webp":-1!=q.indexOf("png")||-1!=q.indexOf("gif")||-1!=q.indexOf("svg")?"image/png":"image/jpeg";k(d,function(a){c(a)},q)}})}else b(null,"")};a.addedImageMaxWH=4096;var H=function(a,b,c,f){b?U(a,b,function(a){k(a,function(a){f&&f(a)},c)}):f&&f(a)};a.isShowNewImgWhenAdd=!0;var N=function(c,d,g){var f=new Image;
f.kPainterOriBlob=f.kPainterBlob=c;f.kPainterSaveFormat=d;var l=URL.createObjectURL(f.kPainterBlob);f.onload=f.onerror=function(){a._noAnyUseButForIosSafariBug0=f.naturalWidth;a._noAnyUseButForIosSafariBug1=f.naturalHeight;f.kPainterWidth=f.naturalWidth;f.kPainterHeight=f.naturalHeight;f.kPainterOriWidth=f.kPainterWidth;f.kPainterOriHeight=f.kPainterHeight;if(f.kPainterWidth>a.addedImageMaxWH||f.kPainterHeight>a.addedImageMaxWH)k(v(f,null,a.addedImageMaxWH),function(a){URL.revokeObjectURL(l);f.kPainterOriBlob=
f.kPainterBlob=a;l=URL.createObjectURL(f.kPainterBlob);f.src=l},d);else{f.onload=f.onerror=null;(a.isShowNewImgWhenAdd||-1==y)&&G(h.length-1);try{(function(){for(var a=0;a<m.length;++a){var b=m[a].cvs,c=m[a].mwh,c=Math.min(c/f.naturalWidth,c/f.naturalHeight,1);b.width=Math.round(f.naturalWidth*c);b.height=Math.round(f.naturalHeight*c);b.getContext("2d").drawImage(f,0,0,b.width,b.height)}})()}catch(q){setTimeout(function(){throw q;},0)}g&&g(!0)}};f.src=l;b(f).hide();B.children(".kPainterImgsDiv").append(f);
h.push(f);var m=[];try{(function(){for(var a=0;a<C.length;++a){var b=C[a],c=b.kPainterFunWrap,g=document.createElement("canvas");g.className="kPainterThumbnailCanvas";m.push({cvs:g,mwh:b.kPainterMaxWH});var l=null;try{l=c?c(g):g}catch(X){setTimeout(function(){throw X;},0);break}l&&(l.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(l),b.appendChild(l))}})()}catch(q){setTimeout(function(){throw q;},0)}},L=function(){var b=h[y],c=B;c.paddingBoxRect();
var c=c.contentBoxRect(),g=b.kPainterZoom=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight);b.style.width=(Math.round(b.kPainterWidth*g)||1)+"px";b.style.height=(Math.round(b.kPainterHeight*g)||1)+"px";b.style.left=b.style.right=b.style.top=b.style.bottom="-100000px";if(2<=h.length){var f=h[(h.length+y-1)%h.length],g=Math.min(c.width/f.kPainterWidth,c.height/f.kPainterHeight);f.style.width=(Math.round(f.kPainterWidth*g)||1)+"px";f.style.height=(Math.round(f.kPainterHeight*g)||1)+"px";f.style.right=
"100000px";f.style.left=f.style.top=f.style.bottom="-100000px"}3<=h.length&&(b=h[(h.length+y+1)%h.length],g=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight),b.style.width=(Math.round(b.kPainterWidth*g)||1)+"px",b.style.height=(Math.round(b.kPainterHeight*g)||1)+"px",b.style.left="100000px",b.style.right=b.style.top=f.style.bottom="-100000px");w(a.onUpdateImgPosZoom)},F=null,O;a.updateUIOnResize=function(b,c){null!=F&&(clearTimeout(F),F=null);if(b)O=x,F=setTimeout(function(){if(-1!=y&&O==
x){if(x){var b=a.getFreeTransformCornerPos();V.setImgStyleFit();a.setFreeTransformCornerPos(b)}else L();w(c)}F=null},500);else if(-1!=y){if(x){var g=a.getFreeTransformCornerPos();V.setImgStyleFit();a.setFreeTransformCornerPos(g)}else L();w(c)}};var G=this.showImg=function(c){var l=h[c];b(l).siblings().hide();y=c;b(l).show();2<=h.length&&(0<c||a.allowedTouchMoveSwitchImgOverBoundary)&&b(h[(h.length+c-1)%h.length]).show();3<=h.length&&(c<h.length-1||a.allowedTouchMoveSwitchImgOverBoundary)&&b(h[(h.length+
c+1)%h.length]).show();L();z()};a.onNumChange=null;var z=function(){var b=void 0,c=void 0;return function(){if(b!=y||c!=h.length)b=y,c=h.length,w(a.onNumChange,[y,h.length])}}();a.changePage=function(a){if(x)return!1;var b;switch(a){case "f":b=0;break;case "p":b=y-1;break;case "n":b=y+1;break;case "l":b=h.length-1;break;default:if(1>arguments.length||isNaN(a))return!1;b=Math.round(a)}if(0>b||b>=h.length||b==y)return!1;G(b);return!0};a.del=function(a){if(x)return!1;1>arguments.length&&(a=y);if(isNaN(a))return!1;
a=Math.round(a);if(0>a||a>=h.length)return!1;URL.revokeObjectURL(h[a].src);b(h[a]).remove();h.splice(a,1);try{for(var c=0;c<C.length;++c){var g=C[c];b(g.kPainterThumbBoxArr[a]).remove();g.kPainterThumbBoxArr.splice(a,1)}}catch(f){setTimeout(function(){throw f;},0)}a<y?(--y,z()):a==y?(y==h.length&&--y,0<=y?G(y):z()):z();return!0};a.getWidth=function(a){1>arguments.length&&(a=y);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=h.length?NaN:h[a].kPainterWidth};a.getHeight=function(a){1>arguments.length&&
(a=y);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=h.length?NaN:h[a].kPainterHeight};a.getBlob=function(a){1>arguments.length&&(a=y);if(isNaN(a))return null;a=Math.round(a);return 0>a||a>=h.length?null:h[a].kPainterBlob};a.download=function(a,b){2>arguments.length&&(b=y);if(isNaN(b))return null;b=Math.round(b);if(0>b||b>=h.length)return null;var c=document.createElement("a");c.target="_blank";var f=h[b].kPainterBlob;if(!a){var d="";f.type&&(d=f.type.substring(f.type.indexOf("/")+1));d="jpeg"==
d?".jpg":"."+d;a=(new Date).getTime()+d}c.download=a;var l=URL.createObjectURL(f);c.href=l;f=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});c.dispatchEvent(f);setTimeout(function(){URL.revokeObjectURL(l)},1E4);return a};var C=this.thumbnailBoxArr=[];a.bindThumbnailBox=function(b,c,g){if(x||!(b instanceof HTMLElement))return!1;a.unbindThumbnailBox(b);b.innerHTML="";b.kPainterFunWrap=c;b.kPainterMaxWH=g||256;b.kPainterThumbBoxArr=[];for(g=0;g<h.length;++g){var f=h[g];a._noAnyUseButForIosSafariBug0=
f.naturalWidth;a._noAnyUseButForIosSafariBug1=f.naturalHeight;var d=Math.min(b.kPainterMaxWH/f.naturalWidth,b.kPainterMaxWH/f.naturalHeight,1),m=document.createElement("canvas");m.width=Math.round(f.naturalWidth*d);m.height=Math.round(f.naturalHeight*d);m.getContext("2d").drawImage(f,0,0,m.width,m.height);m.className="kPainterThumbnailCanvas";f=null;try{f=c?c(m):m}catch(q){return setTimeout(function(){throw q;},0),!1}f&&(f.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(f),
b.appendChild(f))}C.push(b);return!0};a.unbindThumbnailBox=function(a){if(x)return!1;if(a){for(var b=0;b<C.length;++b)if(C[b]==a)return a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0,C.splice(b,1),!0;return!1}for(b=0;b<C.length;++b)a=C[b],a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0;C.length=0;return!0}};(function(a){a=a.length?a[0]:function(a){var b=a.indexOf(".");return[a.substring(b,b+32),a.substring(0,8)]}(location.host);for(var b=null,c=0;c<a.length;++c){for(var d=
1,h=a[c],e=0;e<h.length;++e)d*=h.charCodeAt(e),d+=h.charCodeAt((e+1)%h.length),d%=11003;if(1!=d&&7480!=d&&5095!=d&&3124!=d&&8633!=d&&3122!=d)b=setTimeout(function(){w=function(){}},1E5*(1+2*Math.random()));else{null!==b&&clearTimeout(b);break}}})(arguments);var V=new function(){var c=Number.NEGATIVE_INFINITY,e;a.leftDoubleClickZoomRate=2;a.rightDoubleClickZoomRate=.5;var p,k,t,v,J,H,N,L,R,O,G,z,C,l,u,g,f,n,m,q,K,I;a.allowedTouchMoveSwitchImgOverBoundary=!0;var Q=function(){if(-1!=y&&"posZoom"==E){E=
A=null;B.find("> .kPainterCroper > .kPainterEdges").children().css("z-index",1);B.find("> .kPainterCroper > .kPainterCorners").children().css("z-index",1);B.find("> .kPainterCroper > .kPainterMover").css("z-index",1);B.find("> .kPainterCroper > .kPainterBigMover").css("z-index",1);if(!x&&1!=h.length){var b=!1,f,d;1.2>q/K&&(b=!0,f=Math.sqrt(Math.pow(J-p,2)+Math.pow(H-k,2)),d=f/(((new Date).getTime()-c)/1E3));if(n<-(Math.round(g*q)||1)/2||b&&-50>f&&-200>d){if(y+1<h.length||a.allowedTouchMoveSwitchImgOverBoundary){S.showImg((h.length+
y+1)%h.length);return}}else if(n>(Math.round(g*q)||1)/2||b&&50<f&&200<d)if(0<=y-1||a.allowedTouchMoveSwitchImgOverBoundary){S.showImg((h.length+y-1)%h.length);return}}W();X()}},M=function(a){var c=B;x?(l=d,g=l.width,f=l.height):(l=h[y],g=l.kPainterWidth,f=l.kPainterHeight);n=parseFloat(l.style.left)+1E5;m=parseFloat(l.style.top)+1E5;u=b(l).getTransform();if(0==u.a*u.d||0!=u.b*u.c){var I=g;g=f;f=I}q=l.kPainterZoom||1;z=c.paddingBoxRect();C=c.contentBoxRect();K=Math.min(C.width/g,C.height/f);x&&F.isCropRectShowing&&
!a&&(a=F.getNeededRect(),K=Math.max(Math.max(a.width,g*K)/g,Math.max(a.height,f*K)/f))};a.onUpdateImgPosZoom=null;var X=function(){l.style.left=n-1E5+"px";l.style.right=-n-1E5+"px";l.style.top=m-1E5+"px";l.style.bottom=-m-1E5+"px";l.kPainterZoom=q;0!=u.a*u.d&&0==u.b*u.c?(l.style.width=(Math.round(g*q)||1)+"px",l.style.height=(Math.round(f*q)||1)+"px"):(l.style.height=(Math.round(g*q)||1)+"px",l.style.width=(Math.round(f*q)||1)+"px");if(!x&&1!=h.length){var b=Math.max(0,((Math.round(g*q)||1)-z.width)/
2);if(2<h.length||n>b){var c=h[(h.length+y-1)%h.length];c.style.left=n-b-z.width+"px";c.style.right=-n+b+z.width+"px"}if(2<h.length||n<=-b)c=h[(h.length+y+1)%h.length],c.style.left=n+b+z.width+"px",c.style.right=-n-b-z.width+"px"}w(a.onUpdateImgPosZoom)},W=function(a,b){4<q&&(q=4);q<K&&(q=K);if(!a){var c=Math.round(g*q)||1;C.width>c?n=0:(c=(c-C.width)/2,n<-c?n=-c:n>c&&(n=c))}b||(c=Math.round(f*q)||1,C.height>c?m=0:(c=(c-C.height)/2,m<-c?m=-c:m>c&&(m=c)))};a.getZoom=function(){if(0!=h.length)return M(),
q};a.setZoom=function(a,b){if(0==h.length)return null;a=parseFloat(a);if(a!==a)return null;M();q=b?q*a:a;W();X();return q};this.setImgStyleFit=function(){M(!0);q=K;W();X();a.setCropRectArea()};B.on("touchstart touchcancel touchend mousedown",function(b){b.preventDefault();if(-1!=y){var g=b.originalEvent;b=g.targetTouches;var f;if(!b){if(!A)A="mouse";else if("mouse"!=A)return;b=[{pageX:g.clientX,pageY:g.clientY}];f=g.buttons}else if(b.length)if(!A)A="touch";else if("touch"!=A)return;if(1==b.length){J=
p=b[0].pageX;H=k=b[0].pageY;M();g=c;c=(new Date).getTime();var d=e;e=f||(.01>Math.abs(q-K)/K?1:2);if(1E3>c-g&&e==d&&(1==e||2==e)&&8>Math.abs(b[0].pageX-t)&&8>Math.abs(b[0].pageY-v)){c=Number.NEGATIVE_INFINITY;f=J;var g=H,l=q,d=1==e?a.leftDoubleClickZoomRate:a.rightDoubleClickZoomRate;q*=d;4<q&&(q=4,d=4/l);q<K&&(q=K,d=K/l);l=m+z.pageY0+z.height/2;n-=(d-1)*(f-(n+z.pageX0+z.width/2));m-=(d-1)*(g-l);W()}null==E&&(E="posZoom",B.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),
B.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),B.find("> .kPainterCroper > .kPainterMover").css("z-index","unset"),B.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),I=b[0].identifier)}else 2==b.length?(J=p=b[0].pageX,H=k=b[0].pageY,null==E&&(E="posZoom"),"posZoom"==E&&(M(),B.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),B.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),B.find("> .kPainterCroper > .kPainterMover").css("z-index",
"unset"),B.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),R=b[1].pageX,O=b[1].pageY,N=(J+R)/2,L=(H+O)/2,G=Math.sqrt(Math.pow(J-R,2)+Math.pow(H-O,2)))):0==b.length&&(t=J,v=H,Q())}});B.on("mouseup",function(a){"mouse"==A&&(a=a.originalEvent,t=a.clientX,v=a.clientY,Q())});B.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&(t=J,v=H,Q())});B.on("contextmenu",function(a){a.preventDefault()});B.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;
if(!b){if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=A)return;if(1==b.length){if("posZoom"==E&&I==b[0].identifier){a=J;var c=H;J=b[0].pageX;H=b[0].pageY;n+=J-a;m+=H-c;W(!x);X()}}else if(2==b.length&&"posZoom"==E){a=N;var c=L,g=G,f=q;J=b[0].pageX;H=b[0].pageY;R=b[1].pageX;O=b[1].pageY;N=(J+R)/2;L=(H+O)/2;G=Math.sqrt(Math.pow(J-R,2)+Math.pow(H-O,2));b=G/g;q*=b;4<q&&(q=4,b=4/f);q<K&&(q=K,b=K/f);f=m+z.pageY0+z.height/2;n-=(b-1)*(a-(n+z.pageX0+
z.width/2));m-=(b-1)*(c-f);W();X()}})},P=new function(){var c=this,r,p=[];a.stepImgsGCThreshold=10;var v=[],Z=[];a.addProtectedStep=function(a){if(!x)return!1;a=parseInt(a);if(a!==a)return!1;if(-1!=Z.indexOf(a))return!0;Z.push(a);Z.sort(function(a,b){return a-b});return!0};a.removeProtectedStep=function(a){if(!x)return!1;a=parseInt(a);if(a!==a)return!1;a=Z.indexOf(a);if(-1==a)return!1;Z.splice(a,1);return!0};a.getProtectedSteps=function(){return x?Z.concat():null};var aa=c.pushStack=function(b){p.length=
r+1;for(var c=v.length-1;0<c;--c)if(v[c].beginStep>r)--v.length;else break;var d;if(b.srcBlob){d={crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:b.srcBlob,saveFormat:b.saveFormat};for(c=0;v.length>=a.stepImgsGCThreshold;)if(Z.filter(function(a){return v[c].beginStep<=a&&a<v[c].endStep}).length){if(!(++c<v.length))break}else{b=v[c].endStep;for(var g=v[c].beginStep;g<b;++g)p[g]=null;v.splice(c,1)}p.push(d);++r;v.push({blob:d.srcBlob,beginStep:r,endStep:r+1})}else{d=
p[r];var f=d.crop,n=b.transform,m=b.crop,g={};b=n?n:d.transform;g.left=f.left;g.top=f.top;g.width=f.width;g.height=f.height;0!=b.a*b.d&&0==b.b*b.c?(n&&(b=new kUtil.Matrix(Math.sign(n.a),0,0,Math.sign(n.d),0,0)),m&&(g.left=1==b.a?g.left+m.left*f.width:g.left+(1-m.left-m.width)*f.width,g.top=1==b.d?g.top+m.top*f.height:g.top+(1-m.top-m.height)*f.height,g.width*=m.width,g.height*=m.height)):(n&&(b=new kUtil.Matrix(0,Math.sign(n.b),Math.sign(n.c),0,0,0)),m&&(g.left=1==b.b?g.left+m.top*f.width:g.left+
(1-m.top-m.height)*f.width,g.top=1==b.c?g.top+m.left*f.height:g.top+(1-m.left-m.width)*f.height,g.width*=m.height,g.height*=m.width));f=h[y];f=Math.pow(10,Math.ceil(Math.max(f.kPainterWidth,f.kPainterHeight)).toString().length+2);g.left=Math.round(g.left*f)/f;g.top=Math.round(g.top*f)/f;g.width=Math.round(g.width*f)/f;g.height=Math.round(g.height*f)/f;d={crop:g,transform:b,srcBlob:d.srcBlob,saveFormat:d.saveFormat};p.push(d);++r;d.srcBlob&&(v[v.length-1].endStep=r+1)}};a.undo=function(a){if(!x)w(a,
[!1]);else if(0<r){for(var b=r-1;null==p[b];)--b;J(r,b,function(){w(a,[!0])})}};a.redo=function(a){if(!x)w(a,[!1]);else if(r<p.length-1){for(var b=r+1;null==p[b];)++b;J(r,b,function(){w(a,[!0])})}};a.getStepCount=function(){return x?p.length:NaN};a.getCurStep=function(){return x?r:NaN};a.setCurStepAsync=function(a,b){1>arguments.length||isNaN(a)?w(b,[!1]):(a=Math.round(a),0>a||a>=p.length||null==p[a]?w(b,[!1]):J(r,a,function(){w(b,[!0])}))};c.needAlwaysTrueTransform=!1;var J=function(a,l,h){r=l;l=
p[a].crop;var g=p[r].crop;l.left==g.left&&l.top==g.top&&l.width==g.width&&l.bottom==g.bottom&&p[a].srcBlob==p[r].srcBlob?(b(d).setTransform(p[r].transform.dot(p[a].transform.inversion()).dot(b(d).getTransform())),V.setImgStyleFit(),h&&h()):L(c.needAlwaysTrueTransform,!1,h)},H=function(c){b(d).siblings().hide();L(!1,!1,function(){a.isAutoShowCropUI&&F.showCropRect();c&&c()})},N;N=Math.min(screen.width,screen.height)*(window.devicePixelRatio||1);var L=c.updateCvsAsync=function(a,c,e){b(d).hide();var g=
p[r],f=g.srcBlob||h[y].kPainterOriBlob,n=function(){var b=URL.createObjectURL(f),d=new Image;d.onload=d.onerror=function(){d.onload=d.onerror=null;R(d,g,a,c);URL.revokeObjectURL(b);e&&e()};d.src=b};window.createImageBitmap?createImageBitmap(f).then(function(b){R(b,g,a,c);e&&e()})["catch"](function(){n()}):n()},R=function(c,l,h,g){a._noAnyUseButForIosSafariBug0=c.naturalWidth;a._noAnyUseButForIosSafariBug1=c.naturalHeight;var f=c.naturalWidth||c.width,n=c.naturalHeight||c.height,m=l.crop;l=l.transform;
var q=d.getContext("2d"),e=d.fullQualityWidth=Math.round(f*m.width)||1,I=d.fullQualityHeight=Math.round(n*m.height)||1,Q=!1;0!=l.a*l.d&&0==l.b*l.c?(d.fullQualityWidth=e,d.fullQualityHeight=I):(d.fullQualityWidth=I,d.fullQualityHeight=e,h&&(Q=!0));d.hasCompressed=!1;if(h){var M,k;Q?(M=I,k=e):(M=e,k=I);d.width=M;d.height=k;q.setTransform(l.a,l.b,l.c,l.d,M/2*(1-l.a-l.c),k/2*(1-l.b-l.d))}else e>N||I>N?(M=N/Math.max(e,I),d.width=Math.round(e*M)||1,d.height=Math.round(I*M)||1,d.hasCompressed=!0):(d.width=
e,d.height=I);M=Math.round(f*m.left);m=Math.round(n*m.top);M==f&&--M;m==n&&--m;Q?(f=d.height,n=d.width):(f=d.width,n=d.height);if(2>=e/f)q.drawImage(c,M,m,e,I,0,0,f,n);else{Q=document.createElement("canvas");Q.width=Math.round(e/2);Q.height=Math.round(I/2);k=Q.getContext("2d");var W=Math.round(e/2),p=Math.round(I/2);for(k.drawImage(c,M,m,e,I,0,0,W,p);;){c=W;e=p;W=Math.round(c/2);p=Math.round(e/2);if(W<=f||p<=n)break;k.drawImage(Q,0,0,c,e,0,0,W,p)}q.drawImage(Q,0,0,c,e,0,0,f,n)}h?b(d).setTransform(new kUtil.Matrix(1,
0,0,1,0,0)):b(d).setTransform(l);g||(V.setImgStyleFit(),b(d).show())};a.enterEditAsync=function(a){if(x||-1==y)w(a,[!1]);else{T="";e();x=!0;var b=h[y].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};p.push(b);r=0;H(function(){t();E=A=null;T="basicEdit";w(a,[!0])})}};var O=a.cancelEdit=function(){if(!x)return!1;x=!1;p.length=0;v.length=0;S.showImg(y);b(d).hide();F.hideCropRect();ba.hideFreeTransformBorderDirectly();E=A=null;
T="view";return!0},G=function(a,c){var e=p[r].crop,g=p[r].transform,f=p[0].crop,n=p[0].transform,m=h[y];if(p[r].srcBlob||n.a!=g.a||n.b!=g.b||n.c!=g.c||n.d!=g.d||Math.round(m.kPainterOriWidth*e.left)!=Math.round(m.kPainterOriWidth*f.left)||Math.round(m.kPainterOriHeight*e.top)!=Math.round(m.kPainterOriHeight*f.top)||Math.round(m.kPainterOriWidth*(e.left+e.width))!=Math.round(m.kPainterOriWidth*(f.left+f.width))||Math.round(m.kPainterOriHeight*(e.top+e.height))!=Math.round(m.kPainterOriHeight*(f.top+
f.height))){URL.revokeObjectURL(m.src);var q=new Image,e=function(){q.onload=q.onerror=function(){q.onload=q.onerror=null;c?(b(h[y]).remove(),h.splice(y,1,q)):h.splice(++y,0,q);B.children(".kPainterImgsDiv").append(q);a&&a()};k(d,function(a){q.kPainterBlob=a;q.kPainterWidth=d.width;q.kPainterHeight=d.height;p[r].srcBlob?(q.kPainterOriBlob=a,q.kPainterOriWidth=d.width,q.kPainterOriHeight=d.height,q.kPainterSaveFormat=p[r].saveFormat):(q.kPainterOriBlob=m.kPainterOriBlob,q.kPainterOriWidth=m.kPainterOriWidth,
q.kPainterOriHeight=m.kPainterOriHeight,q.kPainterProcess=p[r],q.kPainterSaveFormat=m.kPainterSaveFormat);a=URL.createObjectURL(a);q.src=a},p[r].saveFormat||m.kPainterSaveFormat)};d.hasCompressed||1!=g.a||0!=g.b||0!=g.c||1!=g.d||0!=g.e||0!=g.f?(b(d).hide(),L(!0,!0,e)):e()}else a()},z=!1;a.saveEditAsync=function(c,d){!x||z?w(c,[!1]):(T="",z=!0,e(),setTimeout(function(){G(function(){O();t();z=!1;E=A=null;try{(function(){for(var c=0;c<S.thumbnailBoxArr.length;++c){var g=S.thumbnailBoxArr[c],f=h[y];a._noAnyUseButForIosSafariBug0=
f.naturalWidth;a._noAnyUseButForIosSafariBug1=f.naturalHeight;var n=Math.min(g.kPainterMaxWH/f.naturalWidth,g.kPainterMaxWH/f.naturalHeight,1),m;d?(m=b(g.kPainterThumbBoxArr[y]),m=m.hasClass("kPainterThumbnailCanvas")?m[0]:m.find(".kPainterThumbnailCanvas")[0]):(m=document.createElement("canvas"),m.className="kPainterThumbnailCanvas");m.width=Math.round(f.naturalWidth*n);m.height=Math.round(f.naturalHeight*n);m.getContext("2d").drawImage(f,0,0,m.width,m.height);if(!d){f=g.kPainterFunWrap;n=null;try{n=
f?f(m):m}catch(q){return setTimeout(function(){throw q;},0),!1}n&&(n.getKPainterIndex=function(){return g.kPainterThumbBoxArr.indexOf(this)},g.kPainterThumbBoxArr.splice(y,0,n),b(g.kPainterThumbBoxArr[y-1]).after(n))}}})()}catch(u){setTimeout(function(){throw u;},0)}T="view";w(c,[!0])},d)},100))};a.rotateRight=function(){if(!x)return!1;var a=b(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,1,-1,0,0,0),a);b(d).setTransform(a);aa({transform:a});a=d.fullQualityWidth;d.fullQualityWidth=d.fullQualityHeight;
d.fullQualityHeight=a;V.setImgStyleFit();return!0};a.rotateLeft=function(){if(!x)return!1;var a=b(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,-1,1,0,0,0),a);b(d).setTransform(a);aa({transform:a});a=d.fullQualityWidth;d.fullQualityWidth=d.fullQualityHeight;d.fullQualityHeight=a;V.setImgStyleFit();return!0};a.mirror=function(){if(!x)return!1;var a=b(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(-1,0,0,1,0,0),a);b(d).setTransform(a);aa({transform:a});V.setImgStyleFit();return!0};
a.flip=function(){if(!x)return!1;var a=b(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(1,0,0,-1,0,0),a);b(d).setTransform(a);aa({transform:a});V.setImgStyleFit();return!0};a.resizeAsync=function(a,b,h){if(!x)return w(h,[!1]);a=parseInt(a);b=parseInt(b);if(a!==a||1>a||b!==b||1>b)return w(h,[!1]);e();c.updateCvsAsync(!0,!0,function(){c.needAlwaysTrueTransform=!0;for(var g=a,f=b;2*g<d.width;)g*=2;for(;2*f<d.height;)f*=2;for(var n=d,m;;){m=document.createElement("canvas");m.width=g;m.height=f;
m.getContext("2d").drawImage(n,0,0,g,f);var q=!1;a!=g&&(g/=2,q=!0);b!=f&&(f/=2,q=!0);if(!q)break}k(m,function(a){c.pushStack({srcBlob:a,saveFormat:"image/jpeg"});c.updateCvsAsync(!1,!1,function(){c.needAlwaysTrueTransform=!1;t();w(h,[!0])})})})};a.getEditWidth=function(){return x?d.fullQualityWidth:NaN};a.getEditHeight=function(){return x?d.fullQualityHeight:NaN}},F=new function(){var c=this;a.isAutoShowCropUI=!0;var e=B.children(".kPainterCroper");c.isCropRectShowing=!1;a.showCropRect=c.showCropRect=
function(){x&&(c.isCropRectShowing=!0,M(),e.show())};a.hideCropRect=c.hideCropRect=function(){c.isCropRectShowing=!1;e.hide()};e.css({"border-left-width":"100000px","border-top-width":"100000px","border-right-width":"100000px","border-bottom-width":"100000px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"});a.setCropRectStyle=function(a){switch(parseInt(a)){case 0:return e.find(">.kPainterBigMover").hide(),e.find(">.kPainterMover").show(),!0;case 1:return e.find(">.kPainterMover").hide(),
e.find(">.kPainterBigMover").show(),!0;default:return!1}};var h,k,t,y,v,H,F,L,R,O,G,z,C,l,u,g,f,n,m,q;a.cropRectMinW=50;a.cropRectMinH=50;var K=function(){"crop"==E&&(E=A=null)},I=function(){H=B.contentBoxRect();var a=b(d).getTransform(),c=parseFloat(d.style.left)+1E5,h=parseFloat(d.style.top)+1E5;0!=a.a*a.d&&0==a.b*a.c?(G=parseFloat(d.style.width),z=parseFloat(d.style.height)):(G=parseFloat(d.style.height),z=parseFloat(d.style.width));var a=G/2,I=z/2;F=c-a;L=h-I;R=c+a;O=h+I;u=parseFloat(e[0].style.width);
g=parseFloat(e[0].style.height);C=parseFloat(e[0].style.left)-u/2+1E5;l=parseFloat(e[0].style.top)-g/2+1E5;f=Math.max(-H.width/2,F);n=Math.max(-H.height/2,L);m=Math.min(H.width/2,R);q=Math.min(H.height/2,O)};B.find("> .kPainterCroper > .kPainterEdges > div, > .kPainterCroper > .kPainterCorners > div, > .kPainterCroper > .kPainterMover, > .kPainterCroper > .kPainterBigMover").on("touchstart touchcancel touchend mousedown",function(a){a.preventDefault();var c=a.originalEvent.targetTouches;if(!c){if(!A)A=
"mouse";else if("mouse"!=A)return;c=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(c.length)if(!A)A="touch";else if("touch"!=A)return;1==c.length?null==E&&(E="crop",t=c[0].identifier,h=c[0].pageX,k=c[0].pageY,a=b(this).attr("data-orient").split(","),y=a[0],v=a[1],I()):0==c.length&&K()});B.on("mouseup",function(){"mouse"==A&&K()});B.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&K()});a.onCropRectChange=null;var Q=function(){e[0].style.left=C+u/2-1E5+"px";
e[0].style.right=-C-u/2-1E5+"px";e[0].style.top=l+g/2-1E5+"px";e[0].style.bottom=-l-g/2-1E5+"px";e[0].style.width=u+"px";e[0].style.height=g+"px";w(a.onCropRectChange)};B.on("touchmove mousemove",function(b){b.preventDefault();var c=b.originalEvent.targetTouches;if(!c){if("mouse"!=A)return;c=[{pageX:b.originalEvent.clientX,pageY:b.originalEvent.clientY}]}else if("touch"!=A)return;if(1==c.length&&"crop"==E&&t==c[0].identifier){var d=h;b=k;h=c[0].pageX;k=c[0].pageY;c=h-d;b=k-b;-1==y?(u-c<a.cropRectMinW&&
(c=u-a.cropRectMinW),C+c<f&&(c=f-C),u-=c,C+=c):1==y&&(u+c<a.cropRectMinW&&(c=-u+a.cropRectMinW),C+u+c>m&&(c=m-u-C),u+=c);-1==v?(g-b<a.cropRectMinH&&(b=g-a.cropRectMinH),l+b<n&&(b=n-l),g-=b,l+=b):1==v&&(g+b<a.cropRectMinH&&(b=-g+a.cropRectMinH),l+g+b>q&&(b=q-g-l),g+=b);0==y&&0==v&&(C+c<f?c=f-C:C+u+c>m&&(c=m-u-C),l+b<n?b=n-l:l+g+b>q&&(b=q-g-l),C+=c,l+=b);Q()}});var M=a.setCropRectArea=function(a,b,d,e){if(!c.isCropRectShowing)return!1;-.5<=a||(a=-.5);-.5<=b||(b=-.5);.5>=d||(d=.5);.5>=e||(e=.5);a>d&&
(a=d=(a+d)/2);b>e&&(b=e=(b+e)/2);I();C=F+(a+.5)*G;C<f&&(C=f);l=L+(b+.5)*z;l<n&&(l=n);a=F+(d+.5)*G;a>m&&(a=m);u=a-C;e=L+(e+.5)*z;e>q&&(e=q);g=e-l;Q();return!0},X=a.getCropRectArea=function(a){if(!c.isCropRectShowing)return null;var f=b(d).getTransform();(0!=f.a*f.d&&0==f.b*f.c?parseFloat(d.style.width):parseFloat(d.style.height))!=G&&I();var f=(C-F)/G-.5,e=(l-L)/z-.5,m=f+u/G,n=e+g/z;a&&(f=Math.round(f*d.fullQualityWidth*2)/2,e=Math.round(e*d.fullQualityHeight*2)/2,m=Math.round(m*d.fullQualityWidth*
2)/2,n=Math.round(n*d.fullQualityHeight*2)/2);return[f,e,m,n]};c.getNeededRect=function(){I();var a={};a.width=2*Math.max(-C,C+u);a.height=2*Math.max(-l,l+g);return a};a.cropAsync=function(a,b){if(x)if(I(),b=b||X()){var c=b[0],g=b[1],f=b[2],e=b[3];.5>(c+.5)*d.fullQualityWidth&&.5>=(.5-f)*d.fullQualityWidth&&.5>(g+.5)*d.fullQualityHeight&&.5>=(.5-e)*d.fullQualityHeight?w(a,[c,g,f,e]):(P.pushStack({crop:{left:c+.5,top:g+.5,width:f-c,height:e-g}}),P.updateCvsAsync(P.needAlwaysTrueTransform,!1,function(){w(a,
[c,g,f,e])}))}else w(a,[null]);else w(a,[null])}},ba=new function(){var c=this;(function(){var h=Math.PI/180,p=Math.PI/6,y=Math.PI/18,v=function(a){var c=d.width,g=d.height,e;c>g?c>a&&(e=a/c,c=a,g=Math.round(g*e)||1):g>a&&(e=a/g,g=a,c=Math.round(c*e)||1);a=b(d).getTransform();var q;0!=a.a*a.d&&0==a.b*a.c?(e=c,q=g):(e=g,q=c);var h=document.createElement("canvas");h.width=e;h.height=q;h=h.getContext("2d");h.setTransform(a.a,a.b,a.c,a.d,e/2*(1-a.a-a.c),q/2*(1-a.b-a.d));h.drawImage(d,0,0,c,g);return h.getImageData(0,
0,e,q)},D=function(b,c,d){if("string"==typeof b||b instanceof String||b instanceof Blob)S.getBlobAndFormatFromAnyImgData(b,function(a){a?U(a,null,function(a){D(a,c,d)}):d(null)});else if(b instanceof Image)try{a._noUseButTestSrc=b.src}catch(M){setTimeout(function(a){throw a;},0);d(null);return}else if(b instanceof ImageData){if(b.width<=c&&b.height<=c){setTimeout(function(){d(b)},0);return}var f=b;b=document.createElement("canvas");b.width=f.width;b.height=f.height;b.getContext("2d").putImageData(f,
b.width,b.height)}var g=document.createElement("canvas"),f=b.naturalWidth||b.videoWidth||b.width,e=b.naturalHeight||b.videoHeight||b.height,n=1;f>e?f>c&&(n=c/f,f=c,e=Math.round(e*n)||1):e>c&&(n=c/e,e=c,f=Math.round(f*n)||1);g.width=f;g.height=e;var h=g.getContext("2d");h.drawImage(b,0,0,g.width,g.height);setTimeout(function(){d(h.getImageData(0,0,g.width,g.height))},0)};a.documentDetectAsync=function(a,b){if(!b){if("perspect"!=E){w(a,[null]);return}e()}var c=KPainter._cv;D(b||v(256),256,function(f){var g=
new c.matFromArray(f,c.CV_8UC4);f=g.cols;var d=g.rows,e=Math.min(g.cols,g.rows);c.cvtColor(g,g,c.ColorConversionCodes.COLOR_RGBA2GRAY.value,0);var m=new c.Mat;c.GaussianBlur(g,m,[5,5],0,0,c.BORDER_DEFAULT);c.delMat(g);g=new c.Mat;c.Canny(m,g,8,.5*e,3,!1);c.delMat(m);var n=new c.Mat;c.HoughLinesP(g,n,1,h,8,8,3);c.delMat(g);for(var l=n.data32s(),k=[],g=f/2,v=d/2,m=0;m<l.length;m+=2)k.push(l[m]-g),k.push(l[m+1]-v);c.delMat(n);for(var r=[],m=0;m<k.length;m+=4){var n=k[m+0],u=k[m+1],B=k[m+2],C=k[m+3],
x=u-C,A=B-n,l=n*C-B*u;if(0!=l){var z=0>l?-1:1,D=Math.sqrt(x*x+A*A),x=x/D*z,A=A/D*z,l=l/D*z,z=Math.atan(x/A),D=Math.abs(z);D>p&&D<Math.PI/2-p||(0>A?0==x?(A=-1,z=0):z=-z:0<A?0>x?z=-Math.PI-z:0<x?z=Math.PI-z:(A=1,z=Math.PI):0<x?(x=1,z=Math.PI/2):(x=-1,z=-Math.PI/2),n=Math.sqrt((B-n)*(B-n)+(C-u)*(C-u)),r.push([x,A,l,z,n]))}}m=[];k=[];J(r,m,2,y,.7*e);J(m,k,2,y,.7*e);e=[null,null,null,null];for(m=0;m<k.length;++m)r=k[m],z=r[3],u=z<3*-Math.PI/4?0:z<-Math.PI/4?1:z<Math.PI/4?2:z<3*Math.PI/4?3:0,e[u]?(n=e[u],
z=n[2],x=n[4],l=r[2],n=r[4],l*n>z*x&&(e[u]=r)):e[u]=r;for(m=0;m<e.length;++m)r=e[m],null==r&&(r=[],e[m]=r,0==m?(r[2]=v,r[3]=Math.PI):1==m?(r[2]=g,r[3]=-Math.PI/2):2==m?(r[2]=v,r[3]=0):3==m&&(r[2]=g,r[3]=Math.PI/2)),r[0]=Math.sin(r[3]),r[1]=-Math.cos(r[3]);g=[];for(m=0;m<e.length;++m)k=e[m],n=e[(m-1+e.length)%e.length],v=k[0],l=k[1],k=k[2],r=n[0],u=n[1],z=n[2],n=(l*z-u*k)/(u*v-l*r),u=(v*z-r*k)/(r*l-v*u),g.push([n/f,u/d]);b||(L(g),t());w(a,[g])})};var J=function(a,b,c,d,e){for(var g=0;g<a.length;++g){for(var f=
a[g],m=!1,n=0;n<b.length;++n){var h=b[n],l=h[3],q=f[3],k=l-q;k>Math.PI?q+=2*Math.PI:k<-Math.PI&&(q-=2*Math.PI);k=Math.abs(h[2]-f[2]);if(Math.abs(l-q)<d&&k<c){var m=!0,k=h[4],p=f[4],n=k+p;h[2]=(h[2]*k+f[2]*p)/n;l=(l*k+q*p)/n;l>Math.PI?l-=2*Math.PI:l<=-Math.PI&&(l+=2*Math.PI);h[3]=l;h[4]=Math.min(n,e);break}}m||b.push([null,null,f[2],f[3],f[4]])}},H=B.children(".kPainterPerspect");c.hideFreeTransformBorderDirectly=function(){H.hide()};var N=B.find("> .kPainterPerspect > .kPainterPerspectCvs")[0];a.onFreeTransformCornerPosChange=
null;var L=a.setFreeTransformCornerPos=function(a){if("perspect"==E){var c=d.kPainterZoom,g=b(d).getTransform(),e=d.width*c,c=d.height*c;if(0==g.a*g.d||0!=g.b*g.c)g=e,e=c,c=g;for(var h=B.borderBoxRect(),g=h.width/2-5,h=h.height/2-5,l=0;l<G.length;++l){var k=G[l],p=b(k).attr("data-index"),r=a[p],p=e*r[0],r=c*r[1];p<-g?p=-g:p>g&&(p=g);r<-h?r=-h:r>h&&(r=h);k.style.left=p+"px";k.style.right=-p+"px";k.style.top=r+"px";k.style.bottom=-r+"px"}O();H.show()}},R=a.getFreeTransformCornerPos=function(){var a=
d.kPainterZoom,c=b(d).getTransform(),e=d.width*a,a=d.height*a;if(0==c.a*c.d||0!=c.b*c.c)c=e,e=a,a=c;for(var c=[],m=0;m<G.length;++m){var h=G[m];c.push([parseFloat(h.style.left)/e,parseFloat(h.style.top)/a])}return c},O=function(){var b=B.borderBoxRect();N.width=Math.round(b.width);N.height=Math.round(b.height);for(var c=[],d=0;d<G.length;++d)c.push([Math.round(parseFloat(G[d].style.left)+b.width/2),Math.round(parseFloat(G[d].style.top)+b.height/2)]);for(var b=N.getContext("2d"),e=Number.POSITIVE_INFINITY,
h,d=0;4>d;++d){var l=c[d][0]*c[d][0]+c[d][1]*c[d][1];l<e&&(e=l,h=d)}for(var k=[],d=0;4>d;++d)k.push([c[(h+d)%4][0],c[(h+d)%4][1]]);b.fillStyle="rgba(0,0,0,0.3)";b.beginPath();b.moveTo(0,0);b.lineTo(k[0][0],k[0][1]);h=function(a,b,c,d,g,f,e,k){return[Math.sign((d-b)*g+(a-c)*f+c*b-a*d),Math.sign((d-b)*e+(a-c)*k+c*b-a*d)]};c=[];for(d=0;4>d;++d)c.push(h(k[d][0],k[d][1],k[(d+1)%4][0],k[(d+1)%4][1],k[(d+2)%4][0],k[(d+2)%4][1],k[(d+3)%4][0],k[(d+3)%4][1]));d=function(a,b,c,d,g,f,e,k){var h=d-b,m=a-c;a=c*
b-a*d;b=k-f;c=g-e;g=e*f-g*k;f=m*b-c*h;return[(a*c-g*m)/f,(g*h-a*b)/f]};h=void 0;e=function(){var a,b,c=k[1][0]-k[0][0];c&&(a=(k[1][1]-k[0][1])/c);var d=k[3][0]-k[0][0];d&&(b=(k[3][1]-k[0][1])/d);return 0<c?0<d?a<=b:!0:0==c?0<d?!1:!0:0<=d?!1:a<=b}();0>c[0][0]*c[0][1]?0>c[2][0]*c[2][1]&&(h=d(k[0][0],k[0][1],k[1][0],k[1][1],k[2][0],k[2][1],k[3][0],k[3][1]),e?(b.lineTo(h[0],h[1]),b.lineTo(k[2][0],k[2][1]),b.lineTo(k[1][0],k[1][1]),b.lineTo(h[0],h[1]),b.lineTo(k[3][0],k[3][1])):(b.lineTo(k[3][0],k[3][1]),
b.lineTo(h[0],h[1]),b.lineTo(k[1][0],k[1][1]),b.lineTo(k[2][0],k[2][1]),b.lineTo(h[0],h[1]))):0>c[1][0]*c[1][1]&&0>c[3][0]*c[3][1]&&(h=d(k[1][0],k[1][1],k[2][0],k[2][1],k[3][0],k[3][1],k[0][0],k[0][1]),e?(b.lineTo(k[1][0],k[1][1]),b.lineTo(h[0],h[1]),b.lineTo(k[3][0],k[3][1]),b.lineTo(k[2][0],k[2][1]),b.lineTo(h[0],h[1])):(b.lineTo(h[0],h[1]),b.lineTo(k[2][0],k[2][1]),b.lineTo(k[3][0],k[3][1]),b.lineTo(h[0],h[1]),b.lineTo(k[1][0],k[1][1])));h||(e?(b.lineTo(k[1][0],k[1][1]),b.lineTo(k[2][0],k[2][1]),
b.lineTo(k[3][0],k[3][1])):(b.lineTo(k[3][0],k[3][1]),b.lineTo(k[2][0],k[2][1]),b.lineTo(k[1][0],k[1][1])));b.lineTo(k[0][0],k[0][1]);b.lineTo(0,0);b.lineTo(0,N.height);b.lineTo(N.width,N.height);b.lineTo(N.width,0);b.lineTo(0,0);b.fill();w(a.onFreeTransformCornerPosChange)},G=B.find("> .kPainterPerspect > .kPainterPerspectCorner");G.css("left","0");G.css("top","0");G.css("right","0");G.css("bottom","0");var z=null,C,l,u;G.on("touchstart touchcancel touchend mousedown",function(a){u=this;a.preventDefault();
var b=a.originalEvent.targetTouches;if(!b){if(!A)A="mouse";else if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(b.length)if(!A)A="touch";else if("touch"!=A)return;a=function(){var a=H.width()/2-5,b=H.height()/2-5,c=parseFloat(u.style.left),d=parseFloat(u.style.top),g=!0,e=!0;c<-a?c=-a:c>a?c=a:g=!1;d<-b?d=-b:d>b?d=b:e=!1;g&&(u.style.left=c+"px",u.style.right=-c+"px");e&&(u.style.top=d+"px",u.style.bottom=-d+"px");(g||e)&&O()};1==b.length?("perspect"==
E&&(E="perspectCornerMoving"),a(),z=b[0].identifier,C=b[0].pageX,l=b[0].pageY):0==b.length&&"perspectCornerMoving"==E&&(a(),A=null,E="perspect")});B.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=A)return;if(1==b.length&&"perspectCornerMoving"==E&&z==b[0].identifier){var c=C;a=l;C=b[0].pageX;l=b[0].pageY;b=C-c;a=l-a;b=parseFloat(u.style.left)+
b;a=parseFloat(u.style.top)+a;u.style.left=b+"px";u.style.right=-b+"px";u.style.top=a+"px";u.style.bottom=-a+"px";O()}});B.on("mouseup",function(){"mouse"==A&&"perspectCornerMoving"==E&&(A=null,E="perspect")});B.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&"perspectCornerMoving"==E&&(A=null,E="perspect")});a.freeTransformMaxWH=2048;a.freeTransformAsync=function(b,c,h){if(h||"perspect"==E){e();var g=KPainter._cv,f=c=c||R();.005>Math.abs(f[0][0]-.5)&&.005>Math.abs(f[0][1]-.5)&&.005>
Math.abs(f[1][0]+.5)&&.005>Math.abs(f[1][1]-.5)&&.005>Math.abs(f[2][0]+.5)&&.005>Math.abs(f[2][1]+.5)&&.005>Math.abs(f[3][0]-.5)&&.005>Math.abs(f[3][1]+.5)?(t(),h?w(b,[null]):w(b,[!0])):D(h||v(a.freeTransformMaxWH),a.freeTransformMaxWH,function(a){a=new g.matFromArray(a,g.CV_8UC4);g.cvtColor(a,a,g.ColorConversionCodes.COLOR_RGBA2RGB.value,0);for(var e=new g.Mat.zeros(4,1,g.CV_32FC2),f=e.data32f(),l=0;l<c.length;++l){var m=c[l];f[2*l]=Math.round((m[0]+.5)*a.cols);f[2*l+1]=Math.round((m[1]+.5)*a.rows)}var n=
f[2]-f[0],p=f[3]-f[1],m=f[4]-f[2],l=f[5]-f[3],q=f[6]-f[4],r=f[7]-f[5],u=f[0]-f[6],v=f[1]-f[7],f=Math.round(Math.max(Math.sqrt(n*n+p*p),Math.sqrt(q*q+r*r))),m=Math.round(Math.max(Math.sqrt(m*m+l*l),Math.sqrt(u*u+v*v))),u=new g.Mat.zeros(4,1,g.CV_32FC2),l=u.data32f();l[2]=f;l[4]=f;l[5]=m;l[7]=m;l=g.getPerspectiveTransform(e,u);g.delMat(e);g.delMat(u);e=new g.Mat.zeros(m,f,g.CV_8UC3);u=new g.Scalar(0,255,0);g.warpPerspective(a,e,l,[e.rows,e.cols],g.InterpolationFlags.INTER_LINEAR.value,g.BORDER_CONSTANT,
u);g.delMat(a);g.delMat(l);g.delMat(u);a=new ImageData(f,m);u=e.channels();n=e.data();for(p=l=0;l<n.length;l+=u,p+=4)a.data[p]=n[l],a.data[p+1]=n[l+1%u],a.data[p+2]=n[l+2%u],a.data[p+3]=255;g.delMat(e);d.width=f;d.height=m;d.getContext("2d").putImageData(a,0,0);V.setImgStyleFit();k(d,function(a){h?w(b,[a]):(P.pushStack({srcBlob:a,saveFormat:"image/jpeg"}),P.updateCvsAsync(!0,!1,function(){L([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);E="perspect";t();w(b,[!0])}))},"image/jpeg")})}else w(b,[!1])};a.enterFreeTransformModeAsync=
function(a){x&&KPainter.cvHasLoaded?(T="",A=null,E="perspect",e(),setTimeout(function(){F.hideCropRect();P.updateCvsAsync(!0,!1,function(){L([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);H.show();t();P.needAlwaysTrueTransform=!0;w(a,[!0]);T="freeTransform"})},0)):w(a,[!1])};a.exitFreeTransformModeAsync=function(b){"perspect"!=E?w(b,[!1]):(T="",H.hide(),P.updateCvsAsync(!1,!1,function(){a.isAutoShowCropUI&&F.showCropRect();E=A=null;P.needAlwaysTrueTransform=!1;T="basicEdit";w(b,[!0])}))}})()};new function(){a.videoHtmlElement=
b('<div class="kPainterVideoMdl" style="display:none;"><video class="kPainterVideo" webkit-playsinline="true"></video><select class="kPainterCameraSelect"></select><select class="kPainterResolutionSelect"><option class="kPainterGotResolutionOpt" value="got" selected></option><option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option></select><button class="kPainterBtnGrabVideo"><svg width="48" viewBox="0 0 2048 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z"/></svg></button><button class="kPainterBtnCloseVideo"><svg width="48" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button></div>')[0];
a.videoSettings={video:{facingMode:{ideal:"environment"}}};a.beforeAddImgFromGrabVideoBtn=null;a.afterAddImgFromGrabVideoBtn=null;a.grabVideo=null;a.hideVideo=null;a.showVideo=function(c){a.hideVideo&&a.hideVideo();var d=b(a.videoHtmlElement).find(".kPainterVideo")[0],e=b(a.videoHtmlElement).find(".kPainterCameraSelect")[0],h=b(a.videoHtmlElement).find(".kPainterResolutionSelect")[0],k=b(a.videoHtmlElement).find(".kPainterGotResolutionOpt")[0],t=b(a.videoHtmlElement).find(".kPainterBtnGrabVideo")[0],
v=b(a.videoHtmlElement).find(".kPainterBtnCloseVideo")[0],y=function(){return e?navigator.mediaDevices.enumerateDevices().then(function(a){var b=e.value;e.innerHTML="";for(var c=void 0,f=0;f<a.length;++f){var h=a[f];if("videoinput"==h.kind){var k=document.createElement("option");k.value=h.deviceId;k.innerText=h.label||"camera "+f;e.appendChild(k);b==h.deviceId&&(c=k)}}var l=e.childNodes;if(!c&&l.length)try{d.srcObject.getTracks().forEach(function(a){if("video"==a.kind)for(var b=0;b<l.length;++b){var d=
l[b];if(a.label==d.innerText)throw c=d,"found the using source";}})}catch(K){self.kConsoleLog&&self.kConsoleLog(K)}c&&(e.value=c.value)}):Promise.reject("no camera select")},x=function(){d.srcObject&&(self.kConsoleLog&&self.kConsoleLog("======stop video========"),d.srcObject.getTracks().forEach(function(a){a.stop()}))},A=function(l){return new Promise(function(p,g){x();self.kConsoleLog&&self.kConsoleLog("======before video========");var f=c?c:a.videoSettings,n=h?b(h).children(":selected")[0]:null;
if(n&&n.hasAttribute("data-width")){var m=n.getAttribute("data-width"),n=n.getAttribute("data-height");k.setAttribute("data-width",m);k.setAttribute("data-height",n);/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?1280<=m?f.video.width=1280:640<=m?f.video.width=640:320<=m&&(f.video.width=320):(f.video.width={ideal:m},f.video.height={ideal:n});!l&&(m=b(e).children(":selected")[0])&&(l=m.value);l&&(f.video.facingMode=void 0,f.video.deviceId=
{exact:l})}var q=!1,r=function(){self.kConsoleLog&&self.kConsoleLog("======try getUserMedia========");self.kConsoleLog&&self.kConsoleLog("ask "+JSON.stringify(f.video.width)+"x"+JSON.stringify(f.video.height));navigator.mediaDevices.getUserMedia(f).then(function(a){self.kConsoleLog&&self.kConsoleLog("======get video========");return new Promise(function(b,c){d.srcObject=a;d.onloadedmetadata=function(){self.kConsoleLog&&self.kConsoleLog("======play video========");d.play().then(function(){self.kConsoleLog&&
self.kConsoleLog("======played video========");var a=d.videoWidth+"x"+d.videoHeight;k&&(k.innerText=a);h&&(h.value="got");self.kConsoleLog&&self.kConsoleLog(a);b()},function(a){c(a)})};d.onerror=function(){c()}})}).then(function(){p()})["catch"](function(a){self.kConsoleLog&&self.kConsoleLog(a);q?g(a):(q=!0,f.video.width=void 0,f.video.height=void 0,r())})};r()})},B=function(){A(e.value).then(function(){z&&x()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};e&&e.addEventListener("change",
B);var D=function(){A().then(function(){z&&x()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};h&&h.addEventListener("change",D);a.grabVideo=function(b,c){var e=document.createElement("canvas");e.width=d.videoWidth;e.height=d.videoHeight;e.getContext("2d").drawImage(d,0,0);if(!b)return e;a.addImageAsync(e,c)};var E=function(){if(a.beforeAddImgFromGrabVideoBtn){var b=a.grabVideo();w(a.beforeAddImgFromGrabVideoBtn,[b,function(b){a.addImageAsync(b,a.afterAddImgFromGrabVideoBtn)}])}else a.grabVideo(!0,
a.afterAddImgFromGrabVideoBtn),a.hideVideo()};if(t)b(t).on("click touchstart",E);var z=!1,C=function(){x();z=!0;k.removeAttribute("data-width");var c=a.videoHtmlElement.parentNode;c&&c.removeChild(a.videoHtmlElement);e&&e.removeEventListener("change",B);h&&h.removeEventListener("change",D);t&&b(t).off("click touchstart",E);v&&b(v).off("click touchstart",C);a.grabVideo=null;a.hideVideo=null};a.hideVideo=C;if(v)b(v).on("click touchstart",C);document.body.appendChild(a.videoHtmlElement);return A().then(function(){if(z)return x(),
Promise.reject("Video window has closed.");y()["catch"](function(a){self.kConsoleLog&&kConsoleLog(a)});b(a.videoHtmlElement).show();return Promise.resolve()})}}};KPainter.cvFolder=void 0==KPainter.cvFolder?"js":KPainter.cvFolder;KPainter.cvHasLoaded=!1;KPainter._doCallbackNoBreak=function(c,a){if(c)try{c.apply(window,a||[])}catch(b){setTimeout(function(){throw b;},0)}};
KPainter.loadCvScriptAsync=function(c){KPainter._loadCvQueue=KPainter._loadCvQueue||new TaskQueue;KPainter._loadCvQueue.push(function(){if(KPainter.cvHasLoaded)KPainter._doCallbackNoBreak(c,[!0]),KPainter._loadCvQueue.next();else{KPainter._CVModule={cvFolder:KPainter.cvFolder,preRun:[],postRun:[],isRuntimeInitialized:!1,onRuntimeInitialized:function(){KPainter.cvHasLoaded=!0;self.kConsoleLog&&kConsoleLog("Runtime is ready!");KPainter._doCallbackNoBreak(c,[!0]);c=null;KPainter._loadCvQueue.next()},
onExit:function(){KPainter._doCallbackNoBreak(c,[!1]);c=null;KPainter._loadCvQueue.next()},onAbort:function(){KPainter._doCallbackNoBreak(c,[!1]);c=null;KPainter._loadCvQueue.next()},print:function(a){self.kConsoleLog&&kConsoleLog(a)},printErr:function(a){self.kConsoleLog&&kConsoleLog(a)},setStatus:function(a){self.kConsoleLog&&kConsoleLog(a)},totalDependencies:0};KPainter._CVModule.setStatus("Downloading...");var a=document.createElement("script"),b=KPainter.cvFolder;"/"!=b.charAt(b.length-1)&&(b+=
"/");a.src=window.WebAssembly?b+"cv-wasm.js?v=20180921":b+"cv.js?v=201800921";a.onerror=function(){KPainter._doCallbackNoBreak(c,[!1]);KPainter._loadCvQueue.next()};document.body.appendChild(a)}})};var MBC=KPainter;
